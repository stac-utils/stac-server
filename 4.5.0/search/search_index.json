{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\ud83c\udf0d STAC Server Documentation","text":"<ul> <li> <p> Getting Started</p> <p>New to STAC Server? Start here for installation and quick setup.</p> <p> Overview \u00b7   Installation \u00b7   Quickstart</p> </li> <li> <p> Guides</p> <p>Learn how to use, configure, and deploy STAC Server.</p> <p> Usage \u00b7   Configuration \u00b7   Deployment</p> </li> <li> <p> Reference</p> <p>API documentation, OpenAPI spec, and architecture details.</p> <p> API Overview \u00b7   OpenAPI Spec \u00b7   Architecture</p> </li> <li> <p> About</p> <p>Contributing, security policy, changelog, and license.</p> <p> Contributing \u00b7   Security \u00b7   Changelog \u00b7   License</p> </li> </ul>"},{"location":"#what-is-stac-server","title":"What is STAC Server?","text":"<p>STAC Server is a production-ready implementation of the STAC API specification with an OpenSearch backend. It provides a scalable, standards-compliant API for searching and accessing spatiotemporal data.</p>"},{"location":"#key-features","title":"Key Features","text":"Powerful Search Search across millions of spatiotemporal items with complex queries, filters, and geospatial operations. STAC Extensions Built-in support for Transaction, Query, Filter, Sort, Fields, Aggregation, and Context extensions. Aggregations Analyze data distributions with frequency histograms, temporal aggregations, and spatial grids. Cloud Native Serverless deployment on AWS with Lambda, API Gateway, OpenSearch, and SNS/SQS for ingestion. Production Ready Battle-tested with Element 84's Earth Search."},{"location":"#architecture","title":"Architecture","text":"<p>STAC Server uses a serverless architecture on AWS:</p> <pre><code>graph LR\n    A[Client] --&gt; B[API Gateway]\n    B --&gt; C[API Lambda]\n    C --&gt; D[OpenSearch]\n    E[SNS Topic] --&gt; F[SQS Queue]\n    F --&gt; G[Ingest Lambda]\n    G --&gt; D\n    H[S3 Bucket] --&gt; G</code></pre> <p>See Architecture for a more detailed diagram.</p>"},{"location":"#standards-compliance","title":"Standards Compliance","text":"<p>STAC Server implements:</p> <ul> <li>STAC Spec v1.1.0 (Items, Collections, Catalogs)</li> <li>STAC API v1.0.0 (Core, Features, Item Search)</li> <li>Extensions: Transaction, Query, Filter (CQL2), Sort, Fields, Context, Aggregation</li> </ul>"},{"location":"#quick-links","title":"Quick Links","text":"<p> GitHub Repository</p> <p> Report Issues</p>"},{"location":"#getting-help","title":"Getting Help","text":"<ul> <li>Documentation Issues: Found something unclear? Edit this page or open an issue</li> <li>Security Issues: See our Security Policy</li> </ul>"},{"location":"#license","title":"License","text":"<p>STAC Server is licensed under the MIT License.</p>"},{"location":"about/changelog/","title":"Changelog","text":"<p>All notable changes to this project will be documented in this file.</p> <p>The format is based on Keep a Changelog and this project adheres to Semantic Versioning.</p>"},{"location":"about/changelog/#unreleased","title":"Unreleased","text":""},{"location":"about/changelog/#changed","title":"Changed","text":"<ul> <li>Documentation Overhaul: Migrated all documentation to a new MkDocs-powered documentation website at stac-utils.github.io/stac-server</li> <li>Comprehensive documentation now organized into Getting Started, Guides, Reference, and About sections</li> <li>Removed top-level markdown files (ARCHITECTURE.md, USAGE.md, DEPLOYMENT.md, CONFIGURATION.md, CONTRIBUTING.md, SECURITY.md) - all content migrated to docs/</li> <li>Updated README.md to serve as GitHub landing page with links to full documentation</li> </ul>"},{"location":"about/changelog/#450","title":"4.5.0","text":""},{"location":"about/changelog/#added","title":"Added","text":"<ul> <li>Asset proxying for generating pre-signed S3 URLs through proxy endpoints <code>GET   /collections/{collectionId}/items/{itemId}/assets/{assetKey}</code> and <code>GET   /collections/{collectionId}/assets/{assetKey}</code>.</li> <li>Environment variables <code>ASSET_PROXY_BUCKET_OPTION</code>, <code>ASSET_PROXY_BUCKET_LIST</code>, and   <code>ASSET_PROXY_URL_EXPIRY</code> to configure asset proxying.</li> </ul>"},{"location":"about/changelog/#changed_1","title":"Changed","text":"<ul> <li>When asset proxying is enabled, when a STAC Item or Collection is served, asset S3 hrefs   are replaced with proxy endpoint URLs and the original S3 URLs are preserved in   <code>alternate.s3.href</code> using the Alternate Assets Extension.</li> </ul>"},{"location":"about/changelog/#fixed","title":"Fixed","text":"<ul> <li>When using the <code>_filter</code> parameter, the combined filter was returned in the <code>next</code> link   body. This had the correct semantics, but the size of the filter would grow by one   <code>and</code> nesting each pagination request, as the <code>_filter</code> was repeatedly added to body.</li> </ul>"},{"location":"about/changelog/#440-2025-09-10","title":"4.4.0 - 2025-09-10","text":""},{"location":"about/changelog/#changed_2","title":"Changed","text":"<ul> <li>If a request includes the <code>STAC-Endpoint</code> header, that endpoint will be used when generating link hrefs.   This deprecates (but still supports) the <code>X-STAC-Endpoint</code> header. This change is in order to comply   with the proprietary header name recommendations in RFC 6648.</li> </ul>"},{"location":"about/changelog/#added_1","title":"Added","text":"<ul> <li>To all endpoints that accept a <code>filter</code> parameter, add support for a query parameter (GET)   or body field (POST) <code>_filter</code> or a header <code>STAC-Filter-Authx</code> that will \"and\" a CQL2   filter expression to the user's   request, such that the extra expression will not be   will not be revealed in link contents. This is controlled by the <code>ENABLE_FILTER_AUTHX</code>   environment variable.</li> <li>To all endpoints that already support the <code>_collections</code> parameter, also support a   header <code>STAC-Collections-Authx</code> to pass the value.</li> </ul>"},{"location":"about/changelog/#430-2025-07-16","title":"4.3.0 - 2025-07-16","text":""},{"location":"about/changelog/#changed_3","title":"Changed","text":"<ul> <li>Compression is enabled by default, can be disabled by setting   <code>ENABLE_RESPONSE_COMPRESSION</code> to <code>false</code>. If using post-hooks, you must update   to hooks to handle compression or disable compression.</li> <li>Update to default to OpenSearch 2.19</li> </ul>"},{"location":"about/changelog/#added_2","title":"Added","text":"<ul> <li>The maximum limit for the number of items returned from the /search and   /collections/{collection_id}/items endpoints can now be configured with the   <code>ITEMS_MAX_LIMIT</code> variable. It is recommended that this be set to 100.</li> </ul>"},{"location":"about/changelog/#420-2025-05-05","title":"4.2.0 - 2025-05-05","text":""},{"location":"about/changelog/#added_3","title":"Added","text":"<ul> <li>Added support for ingest actions, specifically \"truncate collection\". This is enabled   by setting <code>ENABLE_INGEST_ACTION_TRUNCATE</code> to <code>true</code>.</li> </ul>"},{"location":"about/changelog/#changed_4","title":"Changed","text":"<ul> <li>When being ingested, Items and Collection without a <code>links</code> array will not be rejected,   but will have the field added.</li> </ul>"},{"location":"about/changelog/#removed","title":"Removed","text":"<ul> <li>From ingest.js, removed combineDbObjectsIntoBulkOperations and writeRecordsInBulkToDb   functions, as they have not been used since version 2.0.0.</li> </ul>"},{"location":"about/changelog/#410-2025-04-22","title":"4.1.0 - 2025-04-22","text":""},{"location":"about/changelog/#changed_5","title":"Changed","text":"<ul> <li>breaking Collections Auth features (ENABLE_COLLECTIONS_AUTHX) now fails closed   rather than open. If <code>_collections</code> is not specified or is empty, caller has no   access to collections. Also, adds a special collection name <code>*</code> that means access   to all collections is granted.</li> <li>breaking The thumbnails behavior is now disabled by default, and can be enabled   with <code>ENABLE_THUMBNAILS</code> = <code>true</code>.</li> </ul>"},{"location":"about/changelog/#400-2025-04-07","title":"4.0.0 - 2025-04-07","text":""},{"location":"about/changelog/#removed_1","title":"Removed","text":"<ul> <li>Context Extension is now disabled by default, and can be enabled with ENABLE_CONTEXT_EXTENSION</li> <li>Removed configurability of the Root / Landing Page Catalog stac_version via the   STAC_VERSION environment variable. This is now fixed at 1.1.0.</li> <li>Child link relations removed from root (landing page).</li> </ul>"},{"location":"about/changelog/#changed_6","title":"Changed","text":"<ul> <li>Use Node 22 by default.</li> </ul>"},{"location":"about/changelog/#added_4","title":"Added","text":"<ul> <li>To all endpoints that depend on collections, add support for a query parameter (GET)   or body field (POST) <code>_collections</code> that will filter to only those collections, but   will not reveal that in link contents. This is controlled by the \"ENABLE_COLLECTIONS_AUTHX\"</li> </ul>"},{"location":"about/changelog/#3110-2025-03-27","title":"3.11.0 - 2025-03-27","text":""},{"location":"about/changelog/#added_5","title":"Added","text":"<ul> <li>Support for the \"in\" and \"between\" operators of the Filter Extension</li> <li>Support for \"s_intersects\" opeartor of the Filter Extension. This implements both the   \"Basic Spatial Functions\" and \"Basic Spatial Functions with additional Spatial Literals\"   conformance classes, supporting operands for s_intersects of either bbox or GeoJSON   Geometry literals.</li> </ul>"},{"location":"about/changelog/#3100-2025-03-21","title":"3.10.0 - 2025-03-21","text":""},{"location":"about/changelog/#changed_7","title":"Changed","text":"<ul> <li>Use Node 20 by default. Node 20 will be supported by AWS into 2026. Upgrade was   not done to Node 22 because it requires upgrading the ava/typescript library.</li> <li>The default stac_version for the root Catalog / Landing page is now 1.1.0.</li> </ul>"},{"location":"about/changelog/#fixed_1","title":"Fixed","text":"<ul> <li>Removed inapplicable <code>stac_version</code> and <code>stac_extensions</code> fields from ItemCollection</li> </ul>"},{"location":"about/changelog/#390-2025-01-24","title":"3.9.0 - 2025-01-24","text":""},{"location":"about/changelog/#changed_8","title":"Changed","text":"<ul> <li>Update to default to OpenSearch 2.17</li> </ul>"},{"location":"about/changelog/#added_6","title":"Added","text":"<ul> <li>Minimum implementation (basic-cql2 conformance class) of the filter extension for the   <code>/search</code> (GET and POST), <code>/collections/{collectionId}/items</code> (GET), and <code>/aggregate</code>   (GET) endpoints. Only CQL2 JSON is supported.</li> </ul>"},{"location":"about/changelog/#380-2024-05-29","title":"3.8.0 - 2024-05-29","text":""},{"location":"about/changelog/#changed_9","title":"Changed","text":"<ul> <li>Update to default to OpenSearch 2.13</li> </ul>"},{"location":"about/changelog/#370-2024-05-14","title":"3.7.0 - 2024-05-14","text":""},{"location":"about/changelog/#fixed_2","title":"Fixed","text":"<ul> <li>For the first item indexed in a new collection, if all values in the   <code>proj:transform</code> array were integers, the values were typed as integers,   which would then cause an error for subsequent items that had float values   in the array.</li> </ul>"},{"location":"about/changelog/#added_7","title":"Added","text":"<ul> <li>Allow the following CORS headers to be configured with configuration variables:</li> <li>Access-Control-Allow-Origin: <code>CORS_ORIGIN</code></li> <li>Access-Control-Allow-Credentials: <code>CORS_CREDENTIALS</code></li> <li>Access-Control-Allow-Methods: <code>CORS_METHODS</code></li> <li>Access-Control-Allow-Headers: <code>CORS_HEADERS</code></li> </ul>"},{"location":"about/changelog/#360-2024-02-07","title":"3.6.0 - 2024-02-07","text":""},{"location":"about/changelog/#changed_10","title":"Changed","text":"<ul> <li>Deprecated <code>grid_geohex_frequency</code>, <code>grid_geohash_frequency</code>, and   <code>grid_geotile_frequency</code> aggregations in favor of new <code>centroid_geohash_grid_frequency</code>,   <code>centroid_geohex_grid_frequency</code>, and <code>centroid_geotile_grid_frequency</code> aggregations</li> </ul>"},{"location":"about/changelog/#added_8","title":"Added","text":"<ul> <li>Added <code>geometry_geohash_grid_frequency</code> and <code>geometry_geotile_grid_frequency</code> that   aggregate over the geometry of each Item rather than the centroid. Note that the geohex aggregation <code>geometry_geohex_grid_frequency</code> is not implemented, as OpenSearch 2.11   does not yet support geohex_grid aggregations over geo_shape fields.</li> </ul>"},{"location":"about/changelog/#350-2024-01-19","title":"3.5.0 - 2024-01-19","text":""},{"location":"about/changelog/#fixed_3","title":"Fixed","text":"<ul> <li>When using sortby, next links were incorrect.</li> </ul>"},{"location":"about/changelog/#340-2023-12-15","title":"3.4.0 - 2023-12-15","text":""},{"location":"about/changelog/#changed_11","title":"Changed","text":"<ul> <li>Ingest lambda will return a failure if there are errors during ingesting. Previously,   errors would only be logged and the lambda would always return a success response.</li> <li>Landing page (/) and collections endpoint (/collections) now return a 500 if   create_indices has not been run or cannot connect to database.</li> </ul>"},{"location":"about/changelog/#330-2023-12-04","title":"3.3.0 - 2023-12-04","text":""},{"location":"about/changelog/#added_9","title":"Added","text":"<ul> <li>redocly devDependency for docs build</li> </ul>"},{"location":"about/changelog/#removed_2","title":"Removed","text":"<ul> <li>Unused devDependencies for old docs build</li> <li>Old <code>./docs</code> directory and out of date docs</li> <li>Removed support for grid_code_landsat_frequency aggregation.</li> </ul>"},{"location":"about/changelog/#fixed_4","title":"Fixed","text":"<ul> <li>STAC API Docs now build and deploy to GitHub Pages using redocly</li> </ul>"},{"location":"about/changelog/#320-2023-11-29","title":"3.2.0 - 2023-11-29","text":""},{"location":"about/changelog/#added_10","title":"Added","text":"<ul> <li>Better error handling when create_index fails.</li> </ul>"},{"location":"about/changelog/#fixed_5","title":"Fixed","text":"<ul> <li>Removed usages of aws-sdk that were missed in 3.0.0.</li> </ul>"},{"location":"about/changelog/#310-2023-11-28","title":"3.1.0 - 2023-11-28","text":""},{"location":"about/changelog/#added_11","title":"Added","text":"<ul> <li>Added support for AWS IAM authentication to AWS OpenSearch Serverless</li> </ul>"},{"location":"about/changelog/#changed_12","title":"Changed","text":"<ul> <li>Replaced use of aws-os-connection library for AWS IAM authentication with support   in opensearch-js.</li> <li>Default to OpenSearch 2.11</li> </ul>"},{"location":"about/changelog/#300-2023-11-09","title":"3.0.0 - 2023-11-09","text":""},{"location":"about/changelog/#changed_13","title":"Changed","text":"<ul> <li>Use AWS SDK for JavaScript v3 instead of v2</li> <li>Use Node 18 by default (with AWS SDK v3 preinstalled, instead of v2)</li> </ul>"},{"location":"about/changelog/#240-2023-11-08","title":"2.4.0 - 2023-11-08","text":""},{"location":"about/changelog/#changed_14","title":"Changed","text":"<ul> <li>Fix OpenAPI spec version from 1.0.0-rc.4 to 1.0.0</li> <li>Update fields, sort, and query extensions to v1.0.0</li> <li>Update transaction extension to v1.0.0-rc.3</li> <li>Default to OpenSearch 2.9</li> <li>Replace geo_shape mapping for proj:geometry field with object, as this fails when   the geometry is not a valid GeoJSON shape, e.g., coordinate points are not lat/lon.</li> </ul>"},{"location":"about/changelog/#230-2023-09-12","title":"2.3.0 - 2023-09-12","text":""},{"location":"about/changelog/#changed_15","title":"Changed","text":"<ul> <li>Default to OpenSearch 2.7</li> </ul>"},{"location":"about/changelog/#added_12","title":"Added","text":"<ul> <li>\"AWS Connection\" mode support has been re-added.</li> </ul>"},{"location":"about/changelog/#223-2023-07-14","title":"2.2.3 - 2023-07-14","text":""},{"location":"about/changelog/#changed_16","title":"Changed","text":"<ul> <li>Simplify the error handling around geometry errors.</li> <li>When an OpenSearch request returns a 400 status code, use this same status code with a meaningful error message in the stac-server response, instead of always returning a 500 error.</li> </ul>"},{"location":"about/changelog/#222-2023-07-06","title":"2.2.2 - 2023-07-06","text":""},{"location":"about/changelog/#changed_17","title":"Changed","text":"<ul> <li>Revert validation of Search intersects geometry added in 2.0.0, as it was too strict   and rejected some usable geometries.</li> </ul>"},{"location":"about/changelog/#221-2023-07-06","title":"2.2.1 - 2023-07-06","text":""},{"location":"about/changelog/#fixed_6","title":"Fixed","text":"<ul> <li>Aggregations 'grid_code_frequency' and 'grid_code_landsat_frequency' were inadvertently   configured to only return 10 results, now they return all results.</li> </ul>"},{"location":"about/changelog/#added_13","title":"Added","text":"<ul> <li>Added API Gateway logging config to example serverless.yml config.</li> </ul>"},{"location":"about/changelog/#220-2023-07-03","title":"2.2.0 - 2023-07-03","text":""},{"location":"about/changelog/#changed_18","title":"Changed","text":"<ul> <li>Search parameters are now logged at info instead of debug.</li> </ul>"},{"location":"about/changelog/#210-2023-06-29","title":"2.1.0 - 2023-06-29","text":""},{"location":"about/changelog/#fixed_7","title":"Fixed","text":"<ul> <li>Post-ingest SNS topic was not being published to when deployed as a Lambda.</li> </ul>"},{"location":"about/changelog/#200-2023-06-26","title":"2.0.0 - 2023-06-26","text":""},{"location":"about/changelog/#removed_3","title":"Removed","text":"<ul> <li>Elasticsearch is no longer supported as a backend. Only OpenSearch is now supported.</li> <li>Only fine-grained access control is supported for connecting to OpenSearch.   \"AWS Connection\" mode is no longer supported.</li> </ul>"},{"location":"about/changelog/#removed_4","title":"Removed","text":"<ul> <li>Elasticsearch is no longer supported as a backend. Only OpenSearch is now supported.</li> <li>Only fine-grained access control is supported for connecting to OpenSearch.   \"AWS Connection\" mode is no longer supported.</li> </ul>"},{"location":"about/changelog/#added_14","title":"Added","text":"<ul> <li>Publish ingest results to a post-ingest SNS topic</li> <li>Add datetime and bbox attributes to post-ingest SNS messages</li> <li>Support for Query Extension operators neq, startsWith, endsWith, and contains.</li> <li>Validate intersects geometry before sending to Search + better response parsing.</li> </ul>"},{"location":"about/changelog/#changed_19","title":"Changed","text":"<ul> <li>Remove node streams-based ingest code to prepare for post-ingest notifications</li> <li>Use the <code>type</code> field to determine if ingest is a Collection or Item</li> <li>Aggregations <code>grid_code_frequency</code> and <code>grid_code_landsat_frequency</code> are no longer   restricted to 2000 buckets</li> </ul>"},{"location":"about/changelog/#110-2023-05-02","title":"1.1.0 - 2023-05-02","text":""},{"location":"about/changelog/#changed_20","title":"Changed","text":"<ul> <li>Adds API Gateway ID to cloudwatch logs.</li> <li>Logs the start of the request in case of Lambda timeout.</li> </ul>"},{"location":"about/changelog/#100-2023-04-24","title":"1.0.0 - 2023-04-24","text":""},{"location":"about/changelog/#changed_21","title":"Changed","text":"<ul> <li>STAC API Foundation conformance classes are now 1.0.0</li> <li>Updated example serverless configuration to use OpenSearch 2.5.</li> <li>Added <code>stac_version</code> to the default set of fields returned when the <code>fields</code> parameter   is an empty value.</li> <li>STAC API Fields Extension conformance class is now 1.0.0-rc.3</li> </ul>"},{"location":"about/changelog/#removed_5","title":"Removed","text":"<ul> <li>POST /aggregate endpoints were removed, as they didn't work correctly.</li> </ul>"},{"location":"about/changelog/#added_15","title":"Added","text":"<ul> <li>Added support for <code>/aggregations</code>, <code>/collections/{collectionId}/aggregations</code>, and   <code>/collections/{collectionId}/aggregate</code> endpoints.</li> <li><code>/search</code> ItemCollection now has <code>root</code> link relation.</li> <li>Added grid_geohex_frequency, grid_geohash_frequency, and grid_geotile_frequency aggregations</li> </ul>"},{"location":"about/changelog/#fixed_8","title":"Fixed","text":"<ul> <li><code>/api</code> and <code>/api.html</code> endpoints were broken, now fixed</li> </ul>"},{"location":"about/changelog/#081-2023-03-29","title":"0.8.1 - 2023-03-29","text":""},{"location":"about/changelog/#added_16","title":"Added","text":"<ul> <li>Thumbnail support will now look at Asset or Item level <code>storage:region</code> field   to determine the region for generating the pre-signed URL for the thumbnail.   Previously used the default behavior of AWS SDK.</li> </ul>"},{"location":"about/changelog/#080-2023-03-06","title":"0.8.0 - 2023-03-06","text":""},{"location":"about/changelog/#added_17","title":"Added","text":"<ul> <li>Added support for root and collection-level queryables to be used for Query Extension   filtering.</li> </ul>"},{"location":"about/changelog/#070-2023-02-09","title":"0.7.0 - 2023-02-09","text":""},{"location":"about/changelog/#changed_22","title":"Changed","text":"<ul> <li>ESM modules are used instead of CommonJS</li> <li>Updated pre-hook auth token example to use SecretsManager rather than single values.</li> </ul>"},{"location":"about/changelog/#060-2023-01-24","title":"0.6.0 - 2023-01-24","text":""},{"location":"about/changelog/#fixed_9","title":"Fixed","text":"<ul> <li>Log level configuration now has an effect on log levels</li> </ul>"},{"location":"about/changelog/#changed_23","title":"Changed","text":"<ul> <li>Log level must be configured with lowercase values error, warn, info, http, verbose, debug, silly instead of uppercase values (this config had no effect before)</li> <li>Default request logging format is now \"tiny\" instead of \"dev\". Previously, the \"dev\" format   wrote color codes into CloudWatch logs, which cluttered output, as they were not used in display.</li> <li>Search query and response body is now logged at level \"debug\" rather than \"info\"</li> <li>Ingested item body is now logged at level \"debug\" rather than \"info\"</li> </ul>"},{"location":"about/changelog/#052-2023-01-17","title":"0.5.2 - 2023-01-17","text":""},{"location":"about/changelog/#fixed_10","title":"Fixed","text":"<ul> <li>Fixed incorrect usage of <code>application/geo+json</code> in several link relations.</li> <li>When cross-cluster search is configured, the first search without a collection returned   zero results.</li> </ul>"},{"location":"about/changelog/#051-2023-01-10","title":"0.5.1 - 2023-01-10","text":""},{"location":"about/changelog/#changed_24","title":"Changed","text":"<ul> <li>Max size for POST body is now 1mb instead of 100kb.</li> </ul>"},{"location":"about/changelog/#050-2022-12-23","title":"0.5.0 - 2022-12-23","text":""},{"location":"about/changelog/#removed_6","title":"Removed","text":"<ul> <li>stac_api_version is no longer field in the root catalog. This was removed from the   STAC API spec several versions ago, in favor of the conformance classes.</li> <li>STAC_API_VERSION environment variable is no longer supported. The version is now hard-coded   to 1.0.0-rc.2</li> <li><code>lambdaHashingVersion: 20201221</code> is now the default for serverless, and has been removed   from the serverless example config file.</li> </ul>"},{"location":"about/changelog/#added_18","title":"Added","text":"<ul> <li>Adds support for authenticating to OpenSearch with a username and password when   fine-grained access control is enabled.</li> <li>(Experimental) Aggregation Extension endpoint /aggregate</li> <li>Added pre-hook and post-hook Lambda examples</li> <li>POST /collections endpoint to create collections</li> <li>Configuration of shards and replicas for the indices containing Items can now be done   with environment variables ITEMS_INDICIES_NUM_OF_SHARDS and ITEMS_INDICIES_NUM_OF_REPLICAS.</li> <li>(Experimental) Adds Item 'thumbnail' link to presign an s3 protocol thumbnail asset ARN</li> </ul>"},{"location":"about/changelog/#changed_25","title":"Changed","text":"<ul> <li>ES_HOST variable is now OPENSEARCH_HOST, but both will work for now.</li> <li>ES_BATCH_SIZE variable is now INGEST_BATCH_SIZE. Both will work. It is recommended not to   configure this explicitly if not changing the value from the default of 500.</li> <li>Landing Page (root) now has links for both GET and POST methods of search link relation</li> <li>The STAC API version is now 1.0.0-rc.2</li> <li>AWS OpenSearch Service OpenSearch 2.3 is used as the default instead of Elasticsearch 7.10.   See migration section in README.md.</li> <li>The serverless.example.yml file now has zone awareness enabled and an even number of   Elasticsearch nodes</li> <li>Upgrade serverless to 3.x</li> <li>Remove use of serverless-psuedo-parameters</li> <li>Upgrade to Node 16</li> </ul>"},{"location":"about/changelog/#fixed_11","title":"Fixed","text":"<ul> <li>Collections endpoint (/collections) now has <code>self</code> and <code>root</code> link relations.</li> </ul>"},{"location":"about/changelog/#deprecated","title":"Deprecated","text":"<ul> <li>ES_BATCH_SIZE variable (replaced by INGEST_BATCH_SIZE)</li> <li>ES_HOST variable (replaced by OPENSEARCH_HOST variable)</li> </ul>"},{"location":"about/changelog/#042-2022-12-20","title":"0.4.2 - 2022-12-20","text":""},{"location":"about/changelog/#added_19","title":"Added","text":"<ul> <li>(Experimental) Adds Item 'thumbnail' link to presign an s3 protocol thumbnail asset ARN</li> </ul>"},{"location":"about/changelog/#041-2022-07-11","title":"0.4.1 - 2022-07-11","text":""},{"location":"about/changelog/#added_20","title":"Added","text":"<ul> <li>Added proper value for 'collections' parameter in the next page link in the result of a GET request</li> <li>Added mappings for 'id' and 'collection' for default sort keys</li> <li>Added STAC_API_VERSION as an environment variable to the serverless.yml file</li> <li>Added STAC_API_VERSION to display on the API landing page within the api.js file under src/lib/api.js in the collectionsToCatalogLinks function</li> <li>Add support for pre- and post-hooks</li> </ul>"},{"location":"about/changelog/#changed_26","title":"Changed","text":"<ul> <li>Modified sortby and collections parameters in nextlink</li> <li>Used map instead of foreach/push in api.js file</li> <li>Changed the rel type to 'server' for the URL to the STAC API webpage inside the Links object</li> <li>Modified sortby and collections parameters in nextlink</li> <li>Used map instead of foreach/push in api.js file</li> <li>Compression of responses is now handled by API Gateway and not Express. This means that the uncompressed response from stac-server must be less than 6 MB.</li> </ul>"},{"location":"about/changelog/#removed_7","title":"Removed","text":"<ul> <li>Removed the failed-ingest Lambda function from the serverless.yml file since this function is no longer needed</li> <li>Deleted failed-ingest folder from the src/lambdas directory</li> </ul>"},{"location":"about/changelog/#040-2022-04-19","title":"0.4.0 - 2022-04-19","text":""},{"location":"about/changelog/#added_21","title":"Added","text":"<ul> <li>Add conformance classes for <code>STAC API - Features</code> and <code>STAC API - Collections</code>. Both were already fully-supported, but   were not advertised in the landing page conformsTo attribute or the /conformance endpoint.</li> <li>Items larger than 256 KB can now be ingested by writing their contents to S3</li> <li>API responses are now compressed</li> <li>Transaction Extension is now implemented</li> <li>Landing Page link relation service-doc now exists, and points to a Redoc instance</li> <li>If a request includes the <code>X-STAC-Endpoint</code> header, that endpoint will be used when generating link hrefs</li> </ul>"},{"location":"about/changelog/#fixed_12","title":"Fixed","text":"<ul> <li>Open-ended datetime intervals using either empty string or '..' now work</li> <li>Correct content types are now returned</li> <li>Searching for a nonexistent collection returns empty results</li> <li>Re-ingesting an Item maintains the existing value of properties.created and sets properties.updated to now</li> <li>Fixes the responses from <code>/collections/{collectionId}</code>, <code>/collections/{collectionId}/items</code>, and <code>/collection/{collectionId}/items/{itemId}</code>.</li> <li>Search limit parameter is now validated to be between 1 and 10000 inclusive</li> <li>Search datetime parameter is now strictly validated as a RFC 3339 datetime or interval of two datetimes</li> <li>Added <code>root</code> link relation to Landing Page (<code>/</code>)</li> <li>GET /search only accepts a bbox value of a comma-separated string and POST /search   only accepts a bbox array of numbers. Previously, both methods accepted both formats in   violation of the STAC API spec.</li> </ul>"},{"location":"about/changelog/#changed_27","title":"Changed","text":"<ul> <li>Upgrade to Node 14</li> <li>Elasticsearch version update 7.9 -&gt; 7.10</li> <li>Use Express for API routing</li> <li>Item and collection ingest operations will full replace an item with the same ID. Previously, partial-updates were being performed.</li> <li>Improvements to Elasticsearch field mappings</li> <li>PATCH /collections/:collectionId/items/:itemId now returns 204 No Content as succcess instead   of 200 and the updated Item</li> <li>Default sortby is now guaranteed to be stable. Previously, it was only by <code>properties.datetime</code>, not it is   by <code>properties.datetime</code>, <code>id</code>, and <code>collection</code>.</li> <li>ItemCollection results no longer have a <code>prev</code> link relation. This is a by-product of changing   pagination to use Elasticsearch's more performant <code>search_after</code> mechanism rather than <code>page</code></li> <li>Pagination works past 10,000 items now</li> <li>An invalid search <code>intersects</code> parameter may sometimes return a 500 instead of a 400 status code.</li> </ul>"},{"location":"about/changelog/#removed_8","title":"Removed","text":"<ul> <li>Querying Items in a Collection by POST to /collections/:collectionId/items is   no longer supported, as this is forbidden by the STAC API - Features   conformance class because it conflicts with the Transaction Extension</li> </ul>"},{"location":"about/changelog/#031-2021-07-28","title":"0.3.1 - 2021-07-28","text":""},{"location":"about/changelog/#fixed_13","title":"Fixed","text":"<ul> <li>Root catalog now properly includes <code>type: Catalog</code></li> </ul>"},{"location":"about/changelog/#030-2021-07-06","title":"0.3.0 - 2021-07-06","text":""},{"location":"about/changelog/#added_22","title":"Added","text":"<ul> <li>Added conformsTo to root catalog</li> <li>Added geo_point mapping to items -&gt; properties -&gt; epsg:centroid</li> </ul>"},{"location":"about/changelog/#fixed_14","title":"Fixed","text":"<ul> <li>Array GET parameters can now be comma-delimited, as per spec</li> <li>Collections link rel type changed to <code>data</code></li> <li>Added required rel=search links in root</li> <li>Geometry now properly being serialized</li> <li>Multiple security vulnerability updaets in dependent libraries</li> <li>Integration tests</li> </ul>"},{"location":"about/changelog/#changed_28","title":"Changed","text":"<ul> <li>Elasticsearch version update 6.8 -&gt; 7.9</li> <li>Updated all mappings</li> <li>Enforce only HTTPS access</li> <li>Migrate base configuration from t2.small -&gt; t3.small instances</li> <li>Updated integration tests to use more update STAC 1.0.0 spec</li> <li>Some fields, such as assets and links, are now excluded from indexing</li> <li>Enforce https</li> <li>Increase SQS VisibilityTimeout and Ingest Lambda timeout</li> </ul>"},{"location":"about/changelog/#removed_9","title":"Removed","text":"<ul> <li>Mapping types (deprecated in Elasticsearch)</li> </ul>"},{"location":"about/changelog/#021-2020-12-14","title":"0.2.1 - 2020-12-14","text":""},{"location":"about/changelog/#fixed_15","title":"Fixed","text":"<ul> <li>Pagination is now STAC compliant</li> <li>Response from <code>/collections</code> is now STAC compliant</li> <li>Return 404 errors when collections or items not found</li> </ul>"},{"location":"about/changelog/#removed_10","title":"Removed","text":"<ul> <li>Specified mapping for temporal and spatial properties (will auto map)</li> </ul>"},{"location":"about/changelog/#020-2020-09-21","title":"0.2.0 - 2020-09-21","text":""},{"location":"about/changelog/#added_23","title":"Added","text":"<ul> <li>Partial STAC transaction extension added, disabled by default - set ENABLE_TRANSACTIONS_EXTENSION=true to enable</li> </ul>"},{"location":"about/changelog/#changed_29","title":"Changed","text":"<ul> <li>Name changed from 'stac-api' to 'stac-server' to avoid confusion with stac-api-spec</li> <li>Elasticsearch client library updated to @elastic/elasticsearch</li> </ul>"},{"location":"about/changelog/#removed_11","title":"Removed","text":"<ul> <li>Collection properties no longer merged into Item on ingest (commons extension removed from STAC)</li> </ul>"},{"location":"about/changelog/#010-2020-03-20","title":"0.1.0 - 2020-03-20","text":"<p>Initial release, forked from sat-api.</p> <p>Compliant with STAC 0.9.0</p>"},{"location":"about/license/","title":"License","text":"<p>Copyright \u00a9 2016 Development Seed Copyright \u00a9 2020 Element 84, Inc</p> <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p> <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p> <p>THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>"},{"location":"about/security/","title":"Security Policy","text":""},{"location":"about/security/#supported-versions","title":"Supported Versions","text":"<p>Security fixes are provided on a best-effort basis for the current major version. We strongly recommend keeping stac-server updated to the latest release to ensure you have the most recent security patches.</p>"},{"location":"about/security/#reporting-a-vulnerability","title":"Reporting a Vulnerability","text":"<p>The stac-server team takes security bugs seriously. We appreciate your efforts to responsibly disclose your findings.</p>"},{"location":"about/security/#how-to-report-a-security-vulnerability","title":"How to Report a Security Vulnerability","text":"<p>Please do not report security vulnerabilities through public GitHub issues.</p> <p>Instead, please report security vulnerabilities using GitHub's private vulnerability reporting feature.</p> <p>To report a vulnerability, go to the Security Advisories page and create a new security advisory.</p>"},{"location":"about/security/#what-to-include","title":"What to Include","text":"<p>Please include the following information to help us better understand the nature and scope of the possible issue:</p> <ul> <li>Type of issue (e.g., buffer overflow, SQL injection, cross-site scripting)</li> <li>Full paths of source file(s) related to the manifestation of the issue</li> <li>The location of the affected source code (tag/branch/commit or direct URL)</li> <li>Any special configuration required to reproduce the issue</li> <li>Step-by-step instructions to reproduce the issue</li> <li>Proof-of-concept or exploit code (if possible)</li> <li>Impact of the issue, including how an attacker might exploit it</li> </ul>"},{"location":"about/security/#disclosure-policy","title":"Disclosure Policy","text":"<ul> <li>Please give us reasonable time to investigate and address the vulnerability before any public disclosure</li> <li>We will credit you in the security advisory when we publish the fix (unless you prefer to remain anonymous)</li> <li>Once the vulnerability is fixed, we will publish a security advisory on GitHub</li> </ul>"},{"location":"about/security/#security-best-practices","title":"Security Best Practices","text":""},{"location":"about/security/#opensearch-security","title":"OpenSearch Security","text":"<p>When deploying stac-server, follow these OpenSearch security best practices:</p> <ol> <li> <p>Enable Fine-grained Access Control: Use OpenSearch's built-in fine-grained access control for granular permissions (see Deployment Guide)</p> </li> <li> <p>Use Strong Passwords: If using fine-grained access control, ensure master and service account passwords are strong and unique</p> </li> <li> <p>Secrets Management: Store credentials in AWS Secrets Manager rather than environment variables when possible</p> </li> <li> <p>Network Security:</p> </li> <li>Deploy OpenSearch in a VPC</li> <li>Use security groups to restrict access</li> <li> <p>Consider VPC endpoints for AWS services</p> </li> <li> <p>Enable Encryption:</p> </li> <li>Enable encryption at rest for OpenSearch domains</li> <li>Enable node-to-node encryption</li> <li> <p>Use HTTPS/TLS for all connections</p> </li> <li> <p>Regular Updates: Keep OpenSearch and stac-server updated to the latest supported versions</p> </li> </ol>"},{"location":"about/security/#aws-lambda-security","title":"AWS Lambda Security","text":"<ol> <li> <p>Principle of Least Privilege: Grant Lambda functions only the IAM permissions they need</p> </li> <li> <p>Environment Variables: Use encryption for sensitive environment variables</p> </li> <li> <p>VPC Configuration: Deploy Lambdas in a VPC when accessing resources that require it</p> </li> <li> <p>Monitoring: Enable CloudWatch logging and set up alerts for suspicious activity</p> </li> </ol>"},{"location":"about/security/#api-gateway-security","title":"API Gateway Security","text":"<ol> <li> <p>Authentication: Consider implementing authentication for transaction endpoints (see Deployment Guide for IP-based restrictions)</p> </li> <li> <p>Rate Limiting: Configure API Gateway throttling to prevent abuse</p> </li> <li> <p>WAF: Use AWS WAF to protect against common web exploits (note the SQL injection false positive in Deployment Guide)</p> </li> <li> <p>CORS: Configure CORS appropriately for your use case</p> </li> </ol>"},{"location":"about/security/#keeping-up-to-date","title":"Keeping Up to Date","text":"<ul> <li>Watch this repository for security advisories</li> <li>Subscribe to security notifications via GitHub</li> <li>Check the CHANGELOG for security-related updates</li> <li>Join community discussions about security issues</li> </ul>"},{"location":"about/security/#additional-resources","title":"Additional Resources","text":"<ul> <li>OpenSearch Security Documentation</li> <li>AWS Security Best Practices</li> <li>OWASP Top 10</li> </ul>"},{"location":"about/security/#next-steps","title":"Next Steps","text":"<ul> <li>Guides &gt; Deployment - Deploy securely to AWS</li> <li>Guides &gt; Configuration - Configure security settings</li> <li>About &gt; Contributing - Report security issues</li> </ul> <p>Thank you for helping keep stac-server and its users safe!</p>"},{"location":"configuration/","title":"Configuration","text":"<p>Runtime configuration reference for stac-server environment variables and collection-level parameters.</p>"},{"location":"configuration/#environment-variables","title":"Environment Variables","text":""},{"location":"configuration/#opensearchelasticsearch-connection","title":"OpenSearch/Elasticsearch Connection","text":"Variable Description Default Example OPENSEARCH_HOST / ES_HOST Hostname or URL of the OpenSearch/Elasticsearch instance. Can include protocol (<code>https://...</code>) or without. Note: When deploying with serverless.yml, this is automatically set via CloudFormation reference to the OpenSearch domain endpoint. <code>http://127.0.0.1:9200</code> (local) <code>https://search-my-cluster.us-west-2.es.amazonaws.com</code> OPENSEARCH_USERNAME Username for basic authentication to OpenSearch (alternative to IAM or Secrets Manager) None <code>admin</code> OPENSEARCH_PASSWORD Password for basic authentication to OpenSearch (alternative to IAM or Secrets Manager) None <code>MySecurePassword123</code> OPENSEARCH_CREDENTIALS_SECRET_ID AWS Secrets Manager secret ID containing OpenSearch credentials as JSON with <code>username</code> and <code>password</code> fields. Used for Lambda service account when using fine-grained access control. None <code>prod/opensearch/credentials</code> COLLECTIONS_INDEX Name of the OpenSearch index for storing collections <code>collections</code> <code>stac-collections</code> COLLECTION_TO_INDEX_MAPPINGS JSON object mapping collection IDs to custom OpenSearch index names. Enables using shared indices across multiple collections or custom naming schemes. None (one index per collection) <code>{\"sentinel-2-l2a\":\"satellite\",\"sentinel-2-l1c\":\"satellite\"}</code> <p>Deployment Note: When using the provided serverless.yml template, <code>OPENSEARCH_HOST</code> is automatically configured via CloudFormation's <code>Fn::GetAtt</code> to reference the deployed OpenSearch domain endpoint. You only need to manually set this variable for external OpenSearch clusters or local development.</p> <p>Advanced Index Management:</p> <p>By default, each collection uses its own OpenSearch index (named after the collection ID). For advanced use cases, you can use <code>COLLECTION_TO_INDEX_MAPPINGS</code> to:</p> <ul> <li>Share a single index across multiple collections (useful for small collections or similar data types)</li> <li>Apply custom naming schemes for organizational requirements</li> <li>Optimize cross-collection searches by grouping related collections</li> </ul> <p>Example: Mapping multiple Sentinel-2 collections to a shared index: <pre><code>{\n  \"sentinel-2-l2a\": \"satellite-imagery\",\n  \"sentinel-2-l1c\": \"satellite-imagery\",\n  \"landsat-c2-l2\": \"landsat-imagery\"\n}\n</code></pre></p> <p>Set as environment variable: <code>COLLECTION_TO_INDEX_MAPPINGS='{\"sentinel-2-l2a\":\"satellite-imagery\",\"sentinel-2-l1c\":\"satellite-imagery\"}'</code></p> <p>\u26a0\ufe0f Important: When using shared indices, ensure all collections have compatible item schemas. The first collection's mapping will be used for the shared index.</p>"},{"location":"configuration/#api-configuration","title":"API Configuration","text":"Variable Description Default Example STAC_API_URL Full URL of the STAC API (used for generating links in responses). Recommended for custom domains. Auto-detected from API Gateway <code>https://stac.example.com</code> STAC_API_ROOTPATH Root path prefix for the API (used when API is not at domain root) Empty string <code>/stac/v1</code> STAC_ID Unique identifier for the STAC API (shown in landing page) <code>stac-server</code> <code>my-catalog</code> STAC_TITLE Human-readable title for the STAC API (shown in landing page and queryables) <code>A STAC API</code> <code>Earth Search STAC API</code> STAC_DESCRIPTION Description of the STAC API (shown in landing page) <code>A STAC API running on stac-server</code> <code>Open STAC API for satellite imagery search</code> STAC_DOCS_URL URL to API documentation (adds a link in landing page) None <code>https://docs.example.com/stac-api</code> STAC_SERVER_COLLECTION_LIMIT Maximum number of collections to return in <code>/collections</code> endpoint <code>100</code> <code>500</code> ITEMS_MAX_LIMIT Maximum number of items that can be returned in a single search request <code>10000</code> <code>5000</code>"},{"location":"configuration/#cors-settings","title":"CORS Settings","text":"Variable Description Default Example CORS_ORIGIN Allowed origins for CORS requests <code>*</code> (all origins) <code>https://app.example.com,https://admin.example.com</code> CORS_CREDENTIALS Whether to allow credentials in CORS requests <code>false</code> <code>true</code> CORS_METHODS Allowed HTTP methods for CORS requests <code>GET,HEAD,PUT,PATCH,POST,DELETE</code> <code>GET,POST,OPTIONS</code> CORS_HEADERS Additional allowed headers for CORS requests (beyond default browser headers) Empty string <code>X-Custom-Header,Authorization</code>"},{"location":"configuration/#extensions","title":"Extensions","text":"Variable Description Default Notes ENABLE_TRANSACTIONS_EXTENSION Enable the Transactions Extension for creating/updating/deleting items via API <code>false</code> When disabled, items can only be ingested via SNS topic ENABLE_CONTEXT_EXTENSION Enable deprecated Context Extension <code>context</code> object <code>false</code> Deprecated: Adds legacy <code>context.matched</code>/<code>returned</code>/<code>limit</code> object. Note: <code>numberMatched</code> and <code>numberReturned</code> are always returned at root level per STAC API spec ENABLE_THUMBNAILS Enable serving asset thumbnails directly through the API <code>false</code>"},{"location":"configuration/#asset-proxy","title":"Asset Proxy","text":"Variable Description Default Values/Example ASSET_PROXY_BUCKET_OPTION Asset proxy mode controlling which S3 assets are proxied <code>NONE</code> (disabled) <code>NONE</code>, <code>ALL</code>, <code>ALL_BUCKETS_IN_ACCOUNT</code>, <code>LIST</code> ASSET_PROXY_BUCKET_LIST Comma-separated list of S3 bucket names to proxy (required when ASSET_PROXY_BUCKET_OPTION is <code>LIST</code>) None <code>satellite-imagery,landsat-data,sentinel-data</code> ASSET_PROXY_URL_EXPIRY Pre-signed URL expiration time in seconds <code>300</code> (5 minutes) <code>600</code>"},{"location":"configuration/#authorization","title":"Authorization","text":"Variable Description Default Notes ENABLE_COLLECTIONS_AUTHX Enable collection-based authorization filtering <code>false</code> When enabled, expects <code>_collections</code> parameter or <code>stac-collections-authx</code> header ENABLE_FILTER_AUTHX Enable filter-based authorization using CQL2 filters <code>false</code> When enabled, expects <code>_filter</code> parameter or <code>stac-filter-authx</code> header"},{"location":"configuration/#ingest","title":"Ingest","text":"Variable Description Default Notes POST_INGEST_TOPIC_ARN ARN of SNS topic for publishing post-ingest notifications None Example: <code>arn:aws:sns:us-west-2:123456789012:stac-server-prod-post-ingest</code> ENABLE_INGEST_ACTION_TRUNCATE Enable the <code>truncate</code> action for removing all items from a collection <code>false</code> \u26a0\ufe0f Enables destructive data operations"},{"location":"configuration/#prepost-hooks","title":"Pre/Post Hooks","text":"Variable Description Default Use Cases PRE_HOOK ARN of Lambda function to invoke before processing API requests None Authentication, request validation, custom authorization POST_HOOK ARN of Lambda function to invoke after processing API requests None Response transformation, logging, analytics API_KEYS_SECRET_ID AWS Secrets Manager secret ID containing API keys (can be used by custom pre-hook implementations for authentication) None Example: <code>prod/api-keys</code>"},{"location":"configuration/#request-handling-and-logging","title":"Request Handling and Logging","text":"Variable Description Default Values/Example LOG_LEVEL Minimum log level for application logging <code>warn</code> <code>error</code>, <code>warn</code>, <code>info</code>, <code>debug</code> REQUEST_LOGGING_ENABLED Enable HTTP request/response logging <code>true</code> <code>true</code> or <code>false</code> REQUEST_LOGGING_FORMAT Morgan HTTP request logging format <code>tiny</code> <code>combined</code> (Apache combined), <code>common</code> (Apache common), <code>dev</code> (colored for development), <code>short</code>, <code>tiny</code> (minimal), or custom format string ENABLE_RESPONSE_COMPRESSION Enable gzip compression for API responses <code>true</code> <code>true</code> or <code>false</code> AWS_REGION AWS region for service operations (auto-set in Lambda environment) Detected from Lambda <code>us-west-2</code>"},{"location":"configuration/#collection-configuration","title":"Collection Configuration","text":"<p>Collection-level configuration is specified in the Collection JSON document when it is ingested. These parameters control how Items in the collection are indexed, queried, and presented through the API.</p>"},{"location":"configuration/#queryables","title":"Queryables","text":"<p>The <code>queryables</code> field in a Collection defines which properties can be discovered through the Queryables endpoint. This helps API consumers understand what properties they can filter on.</p> <p>Location: Add to Collection JSON root Endpoints Affected: <code>/collections/{collectionId}/queryables</code>, <code>/queryables</code></p>"},{"location":"configuration/#example-configuration","title":"Example Configuration","text":"<pre><code>{\n  \"id\": \"sentinel-2-l2a\",\n  \"type\": \"Collection\",\n  \"title\": \"Sentinel-2 Level-2A\",\n  \"queryables\": {\n    \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n    \"$id\": \"https://stac-api.example.com/collections/sentinel-2-l2a/queryables\",\n    \"type\": \"object\",\n    \"title\": \"Queryables for Sentinel-2 Level-2A\",\n    \"properties\": {\n      \"eo:cloud_cover\": {\n        \"description\": \"Cloud cover percentage (0-100)\",\n        \"type\": \"number\",\n        \"minimum\": 0,\n        \"maximum\": 100\n      },\n      \"platform\": {\n        \"description\": \"Satellite platform\",\n        \"type\": \"string\",\n        \"enum\": [\"sentinel-2a\", \"sentinel-2b\"]\n      },\n      \"instruments\": {\n        \"description\": \"Instrument name\",\n        \"type\": \"array\",\n        \"items\": {\n          \"type\": \"string\",\n          \"enum\": [\"msi\"]\n        }\n      },\n      \"view:sun_elevation\": {\n        \"description\": \"Sun elevation angle in degrees\",\n        \"type\": \"number\",\n        \"minimum\": -90,\n        \"maximum\": 90\n      },\n      \"proj:epsg\": {\n        \"description\": \"EPSG code\",\n        \"type\": \"integer\"\n      }\n    },\n    \"additionalProperties\": true\n  }\n}\n</code></pre>"},{"location":"configuration/#important-notes","title":"Important Notes","text":"<ul> <li>Required fields: <code>$schema</code>, <code>type</code>, <code>title</code>, <code>properties</code></li> <li>additionalProperties: Must be <code>true</code> - stac-server doesn't restrict filtering to only defined properties</li> <li>Extraction behavior: The <code>queryables</code> field is extracted and served from the queryables endpoint but removed when serving the Collection itself from <code>/collections/{collectionId}</code></li> <li>Filtering: All Item <code>properties</code> fields are filterable regardless of queryables definition - queryables are informative only</li> <li>Schema compliance: Use JSON Schema draft 2020-12 for consistency</li> </ul>"},{"location":"configuration/#aggregations","title":"Aggregations","text":"<p>The <code>aggregations</code> array in a STAC Collection defines which statistical summaries and frequency distributions are available through the Aggregation Extension.</p> <p>Location: Add to Collection JSON root Endpoints Affected: <code>/collections/{collectionId}/aggregations</code>, <code>/collections/{collectionId}/aggregate</code>, <code>/aggregate</code></p>"},{"location":"configuration/#example-configuration_1","title":"Example Configuration","text":"<pre><code>{\n  \"id\": \"sentinel-2-l2a\",\n  \"type\": \"Collection\",\n  \"title\": \"Sentinel-2 Level-2A\",\n  \"aggregations\": [\n    {\n      \"name\": \"total_count\",\n      \"data_type\": \"integer\"\n    },\n    {\n      \"name\": \"datetime_min\",\n      \"data_type\": \"datetime\"\n    },\n    {\n      \"name\": \"datetime_max\",\n      \"data_type\": \"datetime\"\n    },\n    {\n      \"name\": \"datetime_frequency\",\n      \"data_type\": \"frequency_distribution\",\n      \"frequency_distribution_data_type\": \"datetime\"\n    },\n    {\n      \"name\": \"cloud_cover_frequency\",\n      \"data_type\": \"frequency_distribution\",\n      \"frequency_distribution_data_type\": \"numeric\"\n    },\n    {\n      \"name\": \"platform_frequency\",\n      \"data_type\": \"frequency_distribution\",\n      \"frequency_distribution_data_type\": \"string\"\n    },\n    {\n      \"name\": \"centroid_geohash_grid_frequency\",\n      \"data_type\": \"frequency_distribution\",\n      \"frequency_distribution_data_type\": \"string\"\n    }\n  ]\n}\n</code></pre>"},{"location":"configuration/#available-aggregations","title":"Available Aggregations","text":"<p>Count Aggregations (data_type: <code>integer</code>): - <code>total_count</code> - Total number of items matching the query</p> <p>Temporal Bounds (data_type: <code>datetime</code>): - <code>datetime_min</code> - Earliest datetime in result set - <code>datetime_max</code> - Latest datetime in result set</p> <p>Frequency Distributions (data_type: <code>frequency_distribution</code>):</p> <p>String distributions (frequency_distribution_data_type: <code>string</code>): - <code>collection_frequency</code> - Distribution by collection ID - <code>platform_frequency</code> - Distribution by <code>platform</code> property - <code>grid_code_frequency</code> - Distribution by <code>grid:code</code> property</p> <p>Numeric distributions (frequency_distribution_data_type: <code>numeric</code>): - <code>cloud_cover_frequency</code> - Distribution by <code>eo:cloud_cover</code> (0-100) - <code>sun_elevation_frequency</code> - Distribution by <code>view:sun_elevation</code> (-90 to 90) - <code>sun_azimuth_frequency</code> - Distribution by <code>view:sun_azimuth</code> (0-360) - <code>off_nadir_frequency</code> - Distribution by <code>view:off_nadir</code> (0-90)</p> <p>Temporal distributions (frequency_distribution_data_type: <code>datetime</code>): - <code>datetime_frequency</code> - Distribution by datetime (monthly intervals by default)</p> <p>Geospatial grid distributions (frequency_distribution_data_type: <code>string</code>): - <code>centroid_geohash_grid_frequency</code> - Geohash grid on <code>proj:centroid</code> property - <code>centroid_geohex_grid_frequency</code> - Geohex grid on <code>proj:centroid</code> property - <code>centroid_geotile_grid_frequency</code> - Geotile grid on <code>proj:centroid</code> property - <code>geometry_geohash_grid_frequency</code> - Geohash grid on Item geometry - <code>geometry_geotile_grid_frequency</code> - Geotile grid on Item geometry</p>"},{"location":"configuration/#aggregation-schema","title":"Aggregation Schema","text":"<p>Each aggregation object requires:</p> <pre><code>{\n  \"name\": \"aggregation_name\",\n  \"data_type\": \"integer | datetime | frequency_distribution\"\n}\n</code></pre> <p>For frequency distributions, also include: <pre><code>{\n  \"name\": \"aggregation_name\",\n  \"data_type\": \"frequency_distribution\",\n  \"frequency_distribution_data_type\": \"string | numeric | datetime\"\n}\n</code></pre></p>"},{"location":"configuration/#query-parameters","title":"Query Parameters","text":"<p>When querying aggregations, use these parameters:</p> <ul> <li>aggregations (required): Comma-separated list of aggregation names</li> <li>Example: <code>?aggregations=total_count,platform_frequency,datetime_min</code></li> <li>aggregation_params: JSON object with parameters for specific aggregations</li> <li>Example: <code>?aggregation_params={\"datetime_frequency\":{\"interval\":\"1y\"}}</code></li> </ul>"},{"location":"configuration/#grid-aggregation-parameters","title":"Grid Aggregation Parameters","text":"<p>Geospatial grid aggregations support additional parameters:</p> <p>Geohash grids: <pre><code>{\n  \"centroid_geohash_grid_frequency\": {\n    \"precision\": 3  // 1-12, controls grid cell size\n  }\n}\n</code></pre></p> <p>Geotile grids: <pre><code>{\n  \"centroid_geotile_grid_frequency\": {\n    \"zoom\": 5  // 0-29, controls tile zoom level\n  }\n}\n</code></pre></p> <p>Geohex grids: <pre><code>{\n  \"centroid_geohex_grid_frequency\": {\n    \"resolution\": 4  // 0-15, controls hexagon size\n  }\n}\n</code></pre></p>"},{"location":"configuration/#important-notes_1","title":"Important Notes","text":"<ul> <li>Ingest timing: Aggregations must be defined when the Collection is ingested - they cannot be added later without reingesting</li> <li>Performance: Grid aggregations on geometry can be expensive for collections with complex geometries</li> <li>Property availability: Ensure the properties referenced by aggregations (e.g., <code>eo:cloud_cover</code>) exist in your Items</li> <li>OpenSearch backend: Grid aggregations use OpenSearch-specific aggregation features</li> </ul>"},{"location":"configuration/#best-practices","title":"Best Practices","text":""},{"location":"configuration/#environment-variable-management","title":"Environment Variable Management","text":"<ol> <li>Use Secrets Manager: Store sensitive credentials (database passwords, API keys) in AWS Secrets Manager rather than environment variables</li> <li>Separate environments: Use different variable values for dev/staging/prod environments</li> <li>Document custom values: Keep a record of non-default values and their rationale</li> <li>Validate on startup: Test critical configurations (database connection) during deployment</li> </ol>"},{"location":"configuration/#collection-configuration_1","title":"Collection Configuration","text":"<ol> <li>Define queryables early: Add queryables to Collections before ingesting large numbers of Items</li> <li>Start with essential aggregations: Don't enable all available aggregations - only those you'll use</li> <li>Test queries first: Verify that properties exist in your Items before adding them to queryables</li> <li>Version control: Keep Collection JSON definitions in version control</li> <li>Document extensions: If using custom properties, document them in Collection description</li> </ol>"},{"location":"configuration/#performance-optimization","title":"Performance Optimization","text":"<ol> <li>Limit result sizes: Set appropriate ITEMS_MAX_LIMIT based on your use case</li> <li>Use compression: Keep ENABLE_RESPONSE_COMPRESSION=true for bandwidth savings</li> <li>Context Extension: Leave ENABLE_CONTEXT_EXTENSION disabled (deprecated extension, not needed since <code>numberMatched</code>/<code>numberReturned</code> are always returned)</li> <li>Grid precision: Start with lower precision values for geospatial grids and increase as needed</li> <li>Index strategy: Use separate indices per collection for large datasets</li> </ol>"},{"location":"configuration/#security","title":"Security","text":"<ol> <li>Restrict CORS: Don't use <code>CORS_ORIGIN=*</code> in production - specify allowed origins</li> <li>Enable authorization: Use ENABLE_COLLECTIONS_AUTHX and ENABLE_FILTER_AUTHX with an API Gateway authorizer</li> <li>Limit transactions: Only enable ENABLE_TRANSACTIONS_EXTENSION if you need public write access</li> <li>Protect ingest: The SNS ingest topic should not be publicly accessible</li> <li>Review hooks: Pre/post hooks have full access to requests and responses - audit carefully</li> </ol>"},{"location":"configuration/#monitoring","title":"Monitoring","text":"<ol> <li>Enable logging: Set LOG_LEVEL=info in production for adequate visibility</li> <li>Request logging: Keep REQUEST_LOGGING_ENABLED=true and use a structured format</li> <li>Post-ingest notifications: Subscribe to POST_INGEST_TOPIC_ARN for ingest monitoring</li> <li>Track errors: Monitor dead letter queue for failed ingests</li> <li>CloudWatch metrics: Use CloudWatch to track API latency, error rates, and throughput</li> </ol>"},{"location":"configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Guides &gt; Usage - Learn how to ingest data and use the API</li> <li>Guides &gt; Deployment - Deploy STAC Server to AWS</li> <li>Reference &gt; API Overview - Complete endpoint specifications</li> </ul>"},{"location":"deployment/","title":"Deployment Guide","text":"<p>Complete guide to deploying stac-server to AWS using the Serverless Framework.</p> <p>For runtime configuration (environment variables, collection-level parameters), see the Configuration Guide.</p>"},{"location":"deployment/#prerequisites","title":"Prerequisites","text":"<ul> <li>Node.js (version specified in package.json)</li> <li>Serverless Framework installed globally or as a dev dependency</li> <li>AWS account with appropriate permissions</li> <li>AWS CLI configured with credentials</li> </ul>"},{"location":"deployment/#getting-started","title":"Getting Started","text":"<p>Clone the repository and navigate to the project directory:</p> <pre><code>git clone https://github.com/stac-utils/stac-server.git\ncd stac-server\n</code></pre> <p>Copy the example serverless config file to a file named serverless.yml:</p> <pre><code>cp serverless.example.yml serverless.yml\n</code></pre>"},{"location":"deployment/#step-1-review-serverless-configuration","title":"Step 1: Review Serverless Configuration","text":"<p>Prior to deployment, review and update your serverless.yml file. In particular, update the <code>stage</code> and <code>region</code> with the desired values in the <code>provider</code> section, and review the environment variables in the <code>provider &gt; environment</code> section.</p> <p>For a complete reference of all environment variables, see the Configuration Guide.</p> <p>Key environment variables for deployment:</p> Name Description Default Value OPENSEARCH_HOST The URL of the OpenSearch cluster (required) OPENSEARCH_CREDENTIALS_SECRET_ID AWS Secrets Manager secret for OpenSearch username/password STAC_ID ID of this catalog stac-server STAC_TITLE Title of this catalog STAC API STAC_DESCRIPTION Description of this catalog A STAC API ENABLE_TRANSACTIONS_EXTENSION Enable Transaction Extension for write operations via API false CORS_ORIGIN Configure CORS allowed origins <code>*</code> <p>See the Configuration Guide for all configuration options including: API settings, CORS, extensions, asset proxy, authorization, ingest, pre/post hooks, request handling, and logging.</p>"},{"location":"deployment/#step-2-choose-an-authentication-method","title":"Step 2: Choose an Authentication Method","text":"<p>There are two types of clients that need to authenticate connections to OpenSearch:</p> <ul> <li>Stac-server's Lambda functions authenticate to read and write STAC data to OpenSearch</li> <li>Users authenticate when accessing OpenSearch via a terminal for debugging and   administration</li> </ul> <p>The choice of an authentication method is permanent. Changing the authentication method after deployment requires creating a new cluster and migrating data. </p> <p>Stac-server supports two authentication methods. Option A (Fine-grained Access Control) is the default and recommended for most deployments.</p> <p>Option A: Fine-grained Access Control (default)</p> <ul> <li>Uses OpenSearch's internal user management system</li> <li>Provides granular role-based permissions within OpenSearch</li> <li>Lambda functions use a dedicated service account</li> <li>Users access OpenSearch with master credentials for administration</li> <li>This is the default configuration in <code>serverless.example.yml</code></li> </ul> <p>Option B: AWS IAM Authentication</p> <ul> <li>Uses AWS IAM roles and policies via AWS Signature Version 4 (SigV4) signing</li> <li>Lambda functions use their IAM execution role</li> <li>Users access OpenSearch with AWS credentials (access keys, profiles, or temporary tokens)</li> <li>Requires tools that support SigV4 signing (<code>curl --aws-sigv4</code>, <code>opensearch-cli</code>, Postman)</li> <li>Simpler setup but less granular control within OpenSearch</li> </ul>"},{"location":"deployment/#step-3-configure-opensearch-authentication","title":"Step 3: Configure OpenSearch Authentication","text":"<p>Option A: Fine-grained Access Control (default)</p> <p>Ensure your serverless.yml file contains these configurations:</p> <p>1. OpenSearch domain configuration (master admin account):</p> <pre><code>OpenSearchInstance:\n  Type: AWS::OpenSearchService::Domain\n  Properties:\n    # ... other properties\n    AdvancedSecurityOptions:\n      Enabled: true\n      InternalUserDatabaseEnabled: true\n      MasterUserOptions:\n        MasterUserName: admin\n        MasterUserPassword: ${env:OPENSEARCH_MASTER_USER_PASSWORD}\n</code></pre> <p>This creates the master admin account used for OpenSearch administration via the terminal or Dashboard.</p> <p>2. Environment variable for Lambda service account credentials (via Secrets Manager - recommended):</p> <pre><code>environment:\n  OPENSEARCH_CREDENTIALS_SECRET_ID: ${self:service}-${self:provider.stage}-opensearch-user-creds\n</code></pre> <p>This configures where the Lambda functions will look for the service account credentials (e.g., <code>stac_server</code> user). You'll create this service account and the secret in Step 5 after deployment. Alternatively, you can set credentials directly via <code>OPENSEARCH_USERNAME</code> and <code>OPENSEARCH_PASSWORD</code> environment variables instead of using Secrets Manager.</p> <p>3. IAM permission to access secrets:</p> <pre><code>iam:\n  role:\n    statements:\n      - Effect: Allow\n        Resource: arn:aws:secretsmanager:${aws:region}:${aws:accountId}:secret:${self:provider.environment.OPENSEARCH_CREDENTIALS_SECRET_ID}-*\n        Action: secretsmanager:GetSecretValue\n</code></pre> <p>Option B: AWS IAM Authentication</p> <p>Modify your serverless.yml file as follows:</p> <p>1. Remove or comment out OpenSearch credential environment variables:</p> <pre><code>environment:\n  # OPENSEARCH_CREDENTIALS_SECRET_ID: ${self:service}-${self:provider.stage}-opensearch-user-creds\n</code></pre> <p>2. Remove or comment out Secrets Manager IAM permission:</p> <pre><code>iam:\n  role:\n    statements:\n      # ... other statements\n      # Not needed for IAM authentication - only for fine-grained access control\n      # - Effect: Allow\n      #   Resource: arn:aws:secretsmanager:${aws:region}:${aws:accountId}:secret:${self:provider.environment.OPENSEARCH_CREDENTIALS_SECRET_ID}-*\n      #   Action: secretsmanager:GetSecretValue\n</code></pre> <p>3. Disable fine-grained access control in OpenSearch domain:</p> <pre><code>OpenSearchInstance:\n  Type: AWS::OpenSearchService::Domain\n  Properties:\n    # ... other properties\n    AdvancedSecurityOptions:\n      Enabled: false\n      InternalUserDatabaseEnabled: false\n      # MasterUserOptions not needed for IAM authentication\n      #   MasterUserName: admin\n      #   MasterUserPassword: ${env:OPENSEARCH_MASTER_USER_PASSWORD}\n</code></pre> <p>4. Ensure Lambda has OpenSearch permissions (already in default config):</p> <pre><code>iam:\n  role:\n    statements:\n      - Effect: Allow\n        Resource: \"arn:aws:es:${aws:region}:${aws:accountId}:domain/*\"\n        Action: \"es:*\"\n</code></pre> <p>5. Configure access policy for OpenSearch domain:</p> <p>When using IAM authentication without fine-grained access control, AWS requires that you restrict access to specific AWS accounts (you cannot use the wildcard <code>\"AWS\": \"*\"</code>, which allows any AWS account). Use the account root principal to restrict access to your AWS account only:</p> <pre><code>OpenSearchInstance:\n  Type: AWS::OpenSearchService::Domain\n  Properties:\n    # ... other properties\n    AccessPolicies:\n      Version: \"2012-10-17\"\n      Statement:\n        - Effect: \"Allow\"\n          Principal: { \"AWS\": \"arn:aws:iam::${aws:accountId}:root\" }\n          Action: \"es:ESHttp*\"\n          Resource: \"arn:aws:es:${aws:region}:${aws:accountId}:domain/${self:service}-${self:provider.stage}/*\"\n</code></pre> <p>This restricts access to IAM principals in your AWS account only. Within your account, access is further controlled by the IAM permissions configured above (only principals with <code>es:*</code> can access).</p>"},{"location":"deployment/#step-4-build-deploy","title":"Step 4: Build &amp; Deploy","text":"<p>First, build the application:</p> <pre><code>npm install\nnpm run build\n</code></pre> <p>Then deploy based on your authentication method:</p> <p>Option A: Fine-grained Access Control</p> <pre><code>OPENSEARCH_MASTER_USER_PASSWORD='your-secure-password' npm run deploy\n</code></pre> <p>Option B: AWS IAM Authentication</p> <pre><code>npm run deploy\n</code></pre> <p>Deployment options:</p> <p>You can customize the deployment with these options:</p> <pre><code># Use a different stage and region:\nnpm run deploy -- --stage mystage --region eu-central-1\n\n# Use a custom serverless config file:\nnpm run deploy -- --config serverless.custom.yml\n\n# Combine options:\nOPENSEARCH_MASTER_USER_PASSWORD='your-secure-password' npm run deploy -- --config serverless.custom.yml --stage prod\n</code></pre>"},{"location":"deployment/#step-5-set-up-authentication-credentials","title":"Step 5: Set Up Authentication Credentials","text":"<p>Option A: Fine-grained Access Control</p> <p>If you used fine-grained access control, complete these steps:</p> <p>1. Comment out MasterUserOptions in serverless.yml</p> <p>After the initial deployment, comment out the <code>MasterUserOptions</code> section in serverless.yml to prevent accidental password changes on subsequent deployments:</p> <pre><code>AdvancedSecurityOptions:\n  Enabled: true\n  InternalUserDatabaseEnabled: true\n  # MasterUserOptions:\n  #   MasterUserName: admin\n  #   MasterUserPassword: ${env:OPENSEARCH_MASTER_USER_PASSWORD}\n</code></pre> <p>2. Create a Lambda service account in OpenSearch</p> <p>The Lambda functions require a separate role-based user account (not the master user). Create this user in OpenSearch and assign it appropriate roles. You can do this via the OpenSearch API or Dashboard.</p> <p>Via OpenSearch API:</p> <p>Set environment variables in your current shell session for <code>HOST</code> (your OpenSearch endpoint) and <code>OPENSEARCH_MASTER_USER_PASSWORD</code>, then run the following commands:</p> <pre><code>export HOST=\"your-opensearch-endpoint.us-east-1.es.amazonaws.com\"\nexport OPENSEARCH_MASTER_USER_PASSWORD=\"your-secure-password\"\n</code></pre> <p>Create the role:</p> <pre><code>curl -X \"PUT\" \"${HOST}/_plugins/_security/api/roles/stac_server_role\" \\\n     -H 'Content-Type: application/json; charset=utf-8' \\\n     -u \"admin:${OPENSEARCH_MASTER_USER_PASSWORD}\" \\\n     -d $'{\n  \"cluster_permissions\": [\n    \"cluster_composite_ops\",\n    \"cluster:monitor/health\"\n  ],\n  \"index_permissions\": [\n    {\n      \"index_patterns\": [\"*\"],\n      \"allowed_actions\": [\"indices_all\"]\n    }\n  ],\n  \"tenant_permissions\": [\n    {\n      \"tenant_patterns\": [\"global_tenant\"],\n      \"allowed_actions\": [\"kibana_all_read\"]\n    }\n  ]\n}'\n</code></pre> <p>Create the user:</p> <pre><code>curl -X \"PUT\" \"${HOST}/_plugins/_security/api/internalusers/stac_server\" \\\n     -H 'Content-Type: application/json; charset=utf-8' \\\n     -u \"admin:${OPENSEARCH_MASTER_USER_PASSWORD}\" \\\n     -d $'{ \"password\": \"your-service-account-password\" }'\n</code></pre> <p>Map the role to the user:</p> <pre><code>curl -X \"PUT\" \"${HOST}/_plugins/_security/api/rolesmapping/stac_server_role\" \\\n     -H 'Content-Type: application/json; charset=utf-8' \\\n     -u \"admin:${OPENSEARCH_MASTER_USER_PASSWORD}\"  \\\n     -d $'{\n  \"users\": [\"stac_server\"]\n}'\n</code></pre> <p>Via OpenSearch Dashboard:</p> <p>Login to the OpenSearch Dashboard with master username (<code>admin</code>) and password. From the left sidebar menu, select \"Security\". Create a new role named <code>stac_server_role</code> with:</p> <ul> <li>Cluster permissions: <code>cluster:monitor/health</code>, <code>cluster_composite_ops</code></li> <li>Index permissions: <code>indices_all</code> on <code>*</code></li> <li>Tenant permissions: <code>global_tenant</code> Read only</li> </ul> <p>Then create an internal user named <code>stac_server</code> and map it to the <code>stac_server_role</code>.</p> <p>3. Store service account credentials</p> <p>If you configured <code>OPENSEARCH_CREDENTIALS_SECRET_ID</code> in Step 3, now create the AWS Secrets Manager secret to store the service account credentials:</p> <ul> <li>Secret type: \"Other type of secret\"</li> <li>Secret name: Must match the value of <code>OPENSEARCH_CREDENTIALS_SECRET_ID</code> (e.g.,   <code>stac-server-dev-opensearch-user-creds</code>)</li> <li>Keys: <code>username</code> and <code>password</code></li> <li>Values: <code>username</code>: <code>stac_server</code>, <code>password</code>: the password you set above when creating   the service account user</li> </ul> <p>If you configured <code>OPENSEARCH_USERNAME</code> and <code>OPENSEARCH_PASSWORD</code> directly in your serverless.yml file in Step 3, you can skip this step - your credentials are already configured.</p> <p>4. Redeploy</p> <p>After storing the service account credentials (via Secrets Manager or environment variables), redeploy to ensure the Lambda functions pick up the credentials:</p> <pre><code>npm run deploy\n</code></pre> <p>Option B: AWS IAM Authentication</p> <p>No authentication credential configuration is required. The Lambda functions will automatically authenticate using their IAM execution role.</p>"},{"location":"deployment/#step-6-disable-automatic-index-creation","title":"Step 6: Disable Automatic Index Creation","text":"<p>It is recommended to disable automatic index creation. This prevents the situation where a group of Items are bulk indexed before the Collection in which they are contained has been created, and an OpenSearch index is created without the appropriate mappings.</p> <p>For fine-grained access control:</p> <pre><code>curl -X \"PUT\" \"${HOST}/_cluster/settings\" \\\n     -H 'Content-Type: application/json; charset=utf-8' \\\n     -u \"admin:${OPENSEARCH_MASTER_USER_PASSWORD}\" \\\n     -d '{\"persistent\": {\"action.auto_create_index\": \"false\"}}'\n</code></pre> <p>Alternatively, set this configuration via the OpenSearch Dashboard.</p> <p>For AWS IAM authentication:</p> <pre><code># For temporary credentials (IAM Identity Center/SSO or assumed roles):\ncurl -X PUT \"${HOST}/_cluster/settings\" \\\n  --aws-sigv4 \"aws:amz:us-east-1:es\" \\\n  --user \"$AWS_ACCESS_KEY_ID:$AWS_SECRET_ACCESS_KEY\" \\\n  -H \"x-amz-security-token:$AWS_SESSION_TOKEN\" \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"persistent\": {\"action.auto_create_index\": \"false\"}}'\n\n# For permanent IAM user credentials:\ncurl -X PUT \"${HOST}/_cluster/settings\" \\\n  --aws-sigv4 \"aws:amz:us-east-1:es\" \\\n  --user \"$AWS_ACCESS_KEY_ID:$AWS_SECRET_ACCESS_KEY\" \\\n  -H 'Content-Type: application/json' \\\n  -d '{\"persistent\": {\"action.auto_create_index\": \"false\"}}'\n</code></pre>"},{"location":"deployment/#step-7-create-collection-index","title":"Step 7: Create Collection Index","text":"<p>The <code>collection</code> index must be created, which stores the metadata about each Collection. Invoke the <code>stac-server-&lt;stage&gt;-ingest</code> Lambda function with a payload of:</p> <pre><code>{\n  \"create_indices\": true\n}\n</code></pre> <p>This can be done with the AWS CLI Version 2:</p> <pre><code>aws lambda invoke \\\n  --function-name stac-server-dev-ingest \\\n  --cli-binary-format raw-in-base64-out \\\n  --payload '{ \"create_indices\": true }' \\\n  /dev/stdout\n</code></pre> <p>Stac-server is now ready to ingest STAC Collections and Items and serve API requests.</p> <p>For runtime configuration (environment variables, collection parameters), see the Configuration Guide.</p>"},{"location":"deployment/#additional-configuration","title":"Additional Configuration","text":""},{"location":"deployment/#proxying-stac-server-through-cloudfront","title":"Proxying stac-server through CloudFront","text":"<p>The API Gateway URL associated with the deployed stac-server instance may not be the URL that you ultimately wish to expose to your API users. AWS CloudFront can be used to proxy to a more human readable URL.</p> <p>Important: When using STAC Server with a proxy in front of it, the base URL for the server, which will be used in all link URLs in response bodies, can be set with the <code>STAC-Endpoint</code> header.</p> <p>In order to set up CloudFront proxying, follow these steps:</p> <ol> <li>Create a new CloudFront distribution (or use an existing distribution).</li> <li>Set the origin to the Gateway API URL (obtain in the stage view of the deployed stac-server). The URL is in the form <code>&lt;##abcde&gt;.execute-api.region.amazonaws.com</code>.</li> <li>Set the origin path to the deployed stage name prepended with a <code>/</code>, (e.g., /dev or /prod).</li> <li>Under behaviors, add a new behavior for the desired URL endpoint or subdomain (e.g., /api or /v0.4.0).</li> <li>Set the 'Origin and origin groups to the URL defined above ('<code>&lt;##abcde&gt;.execute-api.region.amazonaws.com</code>').</li> <li>Set Viewer to HTTPS only and Allowed HTTP Methods to 'GET, HEAD, OPTIONS, PUT, POST, PATCH, DELETE'.</li> <li>Set the Cache Policy to a custom policy that forwards query strings. If one simply disables caching, CloudFront strips the query strings.</li> <li>Optionally, define a LambdaEdge to perform a URL rewrite. This is necessary if your API URL is appended to the root URL (e.g., mydomain.com/api). The Lambda must rewrite the URL to remove the /api. For example:</li> </ol> <pre><code>from re import sub\n\ndef lambda_handler(event, context):\n    request = event['Records'][0]['cf']['request']\n    uri = request[\"uri\"]\n\n    if uri in [\"/\", \"/index.html\"]:\n        response = {\n            \"status\": 302,\n            \"statusDescription\": \"Found\",\n            \"headers\": {\n                \"location\": [{\n                    \"key\": \"Location\",\n                    \"value\": \"/api/\"\n                }]\n            }\n        }\n        return response\n\n    request[\"uri\"] = sub(\"^/api\", \"/\", uri)\n    print(request)\n    return request\n</code></pre>"},{"location":"deployment/#locking-down-transaction-endpoints","title":"Locking down transaction endpoints","text":"<p>If you wanted to deploy STAC Server in a way which ensures certain endpoints have restricted access but others don't, you can deploy it into a VPC and add conditions that allow only certain IP addresses to access certain endpoints. Once you deploy STAC Server into a VPC, you can modify the Resource Policy of the API Gateway endpoint that gets deployed to restrict access to certain endpoints. Here is a hypothetical example. Assume that the account into which STAC Server is deployed is numbered 1234-5678-9123, the API ID is ab1c23def, and the region in which it is deployed is us-west-2. You might want to give the general public access to use any GET or POST endpoints with the API such as the \"/search\" endpoint, but lock down access to the transaction endpoints (see https://github.com/radiantearth/stac-api-spec/tree/master/ogcapi-features/extensions/transaction) to only allow certain IP addresses to access them. These IP addresses can be, for example: 94.61.192.106, 204.176.50.129, and 11.27.65.78. In order to do this, you can impose a condition on the API Gateway that only allows API transactions such as adding, updating, and deleting STAC items from the whitelisted endpoints. For example, here is a Resource Policy containing two statements that allow this to happen:</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": \"*\",\n      \"Action\": \"execute-api:Invoke\",\n      \"Resource\": [\n        \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/POST/search\",\n        \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/POST/search/*\",\n        \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/GET/search/*\",\n        \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/GET/*\"\n      ]\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": \"*\",\n      \"Action\": \"execute-api:Invoke\",\n      \"Resource\": [\n        \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/POST/collections/*/items\",\n        \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/PUT/collections/*/items/*\",\n        \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/PATCH/collections/*/items/*\",\n        \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/DELETE/collections/*/items/*\"\n      ],\n      \"Condition\": {\n        \"IpAddress\": {\n          \"aws:sourceIp\": [\"94.61.192.106\", \"204.176.50.129\", \"11.27.65.78\"]\n        }\n      }\n    }\n  ]\n}\n</code></pre> <p>The first statement in the Resource Policy above grants access to STAC API endpoints for use in general operations like searching, and the second statement restricts access to the Transaction endpoints to a set of source IP addresses. According to this policy, POST, PUT, PATCH, and DELETE operations on items within collections are only allowed if the request originates from the IP addresses 94.61.192.106, 204.176.50.129, or 11.27.65.78. The second statement can also be written in another manner, denying access to the Transaction endpoints for all addresses that don't match a set of source IP addresses. This is shown below.</p> <pre><code>{\n  \"Effect\": \"Deny\",\n  \"Principal\": \"*\",\n  \"Action\": \"execute-api:Invoke\",\n  \"Resource\": [\n    \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/POST/collections/*/items\",\n    \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/PUT/collections/*/items/*\",\n    \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/PATCH/collections/*/items/*\",\n    \"arn:aws:execute-api:us-west-2:123456789123:ab1c23def/v1/DELETE/collections/*/items/*\"\n  ],\n  \"Condition\": {\n    \"NotIpAddress\": {\n      \"aws:sourceIp\": [\"94.61.192.106\", \"204.176.50.129\", \"11.27.65.78\"]\n    }\n  }\n}\n</code></pre>"},{"location":"deployment/#aws-waf-rule-conflicts","title":"AWS WAF Rule Conflicts","text":"<p>Frequently, stac-server is deployed with AWS WAF protection. When making a POST request that only has the <code>limit</code> parameter in the body, a WAF SQL injection protection rule incurs a false positive and returns a Forbidden status code. This request is an example:</p> <pre><code>curl -X POST ${HOST}/search -d '{\"limit\": 1}'\n</code></pre> <p>This is also triggered when using pystac_client with no filtering parameters.</p> <p>The fix is to disable the WAF SQL injection rule, which is unnecessary because stac-server does not use SQL.</p>"},{"location":"deployment/#api-gateway-logging","title":"API Gateway Logging","text":"<p>The example serverless.yml config contains disabled configuration for setting up API Gateway logging of API requests. More information about these configuration can be found in the Serverless Framework API Gateway Documentation.</p> <p>The <code>executionLogging</code> setting causes logging of the actual execution of the API Gateway endpoints and backing Lambda, with <code>fullExecutionData</code> causing the entire request and response to be logged to CloudWatch, which can be expensive.</p> <p>The <code>accessLogging</code> setting logs the values specified in <code>format</code> to CloudWatch, which can be useful for computing metrics on usage for the API.</p>"},{"location":"deployment/#supporting-cross-cluster-search-and-replication","title":"Supporting Cross-cluster Search and Replication","text":"<p>OpenSearch support cross-cluster connections that can be configured to either allow search across the clusters, treating a remote cluster as if it were another group of nodes in the cluster, or configure indices to be replicated (continuously copied) from from one cluster to another.</p> <p>Configuring either cross-cluster behavior requires fine-grained access control.</p>"},{"location":"deployment/#cross-cluster-search","title":"Cross-cluster Search","text":"<p>The AWS documentation for cross-cluster search can be found here.</p> <ol> <li>Ensure fine-grained access control is enabled.</li> <li>Create a connection between the source and destination OpenSearch domains.</li> <li>Ensure there is a <code>es:ESCrossClusterGet</code> action in the destination's access policy.</li> <li>In the source stac-server, create a Collection for each collection to be mapped. This    must have the same id as the destination collection.</li> <li>For the source stac-server, configure a <code>COLLECTION_TO_INDEX_MAPPINGS</code>    environment variable with a stringified JSON object mapping the collection name to the    name of the index. For example, <code>{\"collection1\": \"cluster2:collection1\", \"collection2\": \"cluster2:collection2\"}</code> is a value mapping two collections through a    connection named <code>cluster2</code>. Deploy this change.</li> </ol>"},{"location":"deployment/#cross-cluster-replication","title":"Cross-cluster Replication","text":"<p>The AWS documentation for cross-cluster replication can be found here.</p> <ol> <li>Ensure fine-grained access control is enabled (default as of v2.0.0)</li> <li>Create the replication connection in the source to the destination</li> <li>Create the collection in the source's stac-server instance</li> </ol>"},{"location":"deployment/#pre-and-post-hooks","title":"Pre- and Post-Hooks","text":"<p>Stac-server supports two hooks into the request process: a pre-hook and a post-hook. These are each Lambda functions which, if configured, will be invoked by stac-server. It is assumed that the stac-server Lambda has been granted permission to invoke these Lambda functions, if configured.</p>"},{"location":"deployment/#pre-hook","title":"Pre-Hook","text":"<p>If the stac-server is deployed with the <code>PRE_HOOK</code> environment variable set to the name of a Lambda function, then that function will be called as the pre-hook.</p> <p>The event passed into the pre-hook Lambda will be an instance of an API Gateway Proxy Event.</p> <p>If the return value from the pre-hook Lambda is an instance of an API Gateway Proxy Result, then that response will immediately be returned to the client.</p> <p>If the return value of the pre-hook Lambda is an instance of an API Gateway Proxy Event, then that event will be passed along to stac-server.</p> <p>If the pre-hook Lambda throws an exception, an internal server error will be returned to the client.</p> <p>The pre-hook Lambda configuration may reference any Lambda, not only one deployed as part of this stack. There is an example pre-hook Lambda that can be included with this stack, which provides an example rudimentary authorization mechanism via a hard-coded token.</p> <p>To enable this example pre-hook:</p> <ul> <li>Either (1) in package.json, pass the env var <code>BUILD_PRE_HOOK=true</code> in the <code>build</code>   command, or (2) modify bin/build.sh to always build the \"pre-hook\" package.</li> <li>In the serverless.yml file, uncomment the <code>preHook</code> function, the <code>preHook</code> IAM   permissions, and the environment variables <code>PRE_HOOK</code> and <code>API_KEYS_SECRET_ID</code></li> <li>Create a Secrets Manager secret with the name used in <code>API_KEYS_SECRET_ID</code> with   the keys as the strings allowed for API Keys and the values as an array <code>[\"write\"]</code>.</li> <li>Build and deploy.</li> </ul>"},{"location":"deployment/#post-hook","title":"Post-Hook","text":"<p>If the stac-server is deployed with the <code>POST_HOOK</code> environment variable set to the name of a Lambda function, then that function will be called as the post-hook.</p> <p>The event passed into the post-hook labmda will be the response from the stac-server, and will be an instance of an API Gateway Proxy Result.</p> <p>The return value of the post-hook Lambda must be an instance of an API Gateway Proxy Result.</p> <p>If the post-hook Lambda throws an exception, an internal server error will be returned to the client.</p> <p>The post-hook Lambda configuration may reference any Lambda, not only one deployed as part of this stack. There is an example post-hook Lambda that can be included with this stack, which does nothing, but shows how the API Lambda response can be modified.</p> <p>The post-hook Lambda configuration may reference any Lambda, not only one deployed as part of this stack. There is an example post-hook Lambda that can be included with this stack, which provides an example of how to interact with the response, but does not modify it.</p> <p>If compression is enabled with <code>ENABLE_RESPONSE_COMPRESSION</code>, you should ensure that the post-hook deployed handles compressed responses, or for the example post-hook lambda, disable compression.</p> <p>To enable this example post-hook:</p> <ul> <li>Modify bin/build.sh to not exclude the \"post-hook\" package from being built.</li> <li>In the serverless.yml file, uncomment the <code>postHook</code> function and the <code>postHook</code>   IAM permissions.</li> <li>Build and deploy.</li> </ul>"},{"location":"deployment/#request-flow","title":"Request Flow","text":"<pre><code>flowchart\n  client -- APIGatewayProxyEvent --&gt; pre-hook\n  pre-hook[pre-hook Lambda]\n  pre-hook -- APIGatewayProxyResult --&gt; client\n  pre-hook -- APIGatewayProxyEvent --&gt; stac-server\n  post-hook[post-hook Lambda]\n  stac-server -- APIGatewayProxyResult --&gt; post-hook\n  post-hook -- APIGatewayProxyResult --&gt; client</code></pre>"},{"location":"deployment/#notes","title":"Notes","text":"<p>Lambda payloads and responses must be less than 6 MB. A larger payload will result in an internal server error being returned to the client.</p> <p>The outputs of the pre- and post-hooks are validated and, if they don't comply with the defined schemas, an internal server error will be returned to the client. Information about the invalid event, as well as details about the parsing errors, will be logged to CloudWatch.</p>"},{"location":"deployment/#migration-notes","title":"Migration Notes","text":""},{"location":"deployment/#warnings","title":"Warnings","text":"<ul> <li>When upgrading to at least OpenSearch 2.7, there seems to be some low-level problem   in the Lucene data storage that is a problem with indices created in some but not all   versions older   than 2.7. Indices created on the latest version in Fall of 2023 were not affected, but   indices created is some previous version or versions are.   After upgrading to 2.7, items may fail with the message reason \"cannot   change field \\\"geometry\\\" from doc values type=NONE to inconsistent doc values   type=BINARY\". There is no publicly-available information about this being a problem.   The solution is to create a new index by creating a new collection with a different   name, reindex the existing index into the newly-created index, delete and re-created   the existing index by creating a collection, and reindex back into the index.</li> </ul>"},{"location":"deployment/#410","title":"4.1.0","text":""},{"location":"deployment/#thumbnails-feature-disabled-by-default","title":"Thumbnails feature disabled by default","text":"<p>The thumbnails behavior is now disabled by default, and can be enabled with <code>ENABLE_THUMBNAILS</code> = <code>true</code>.</p>"},{"location":"deployment/#400","title":"4.0.0","text":""},{"location":"deployment/#context-extension-disabled-by-default","title":"Context Extension disabled by default","text":"<p>Context Extension is now disabled by default, and can be enabled with ENABLE_CONTEXT_EXTENSION env var. Usage of the \"context\" object \"limit\", \"matched\", and \"returned\" fields can be replaced with the root-level fields \"numberMatched\" and \"numberReturned\".</p>"},{"location":"deployment/#node-22-update","title":"Node 22 update","text":"<p>The default Lambda deployment environment is now Node 22.</p> <p>To update the deployment to use Node 22, modify the serverless config file value <code>provider.runtime</code> to be <code>nodejs22.x</code> and the application re-deployed.</p>"},{"location":"deployment/#hidden-collections-filter","title":"Hidden collections filter","text":"<p>To all endpoints that depend on collections, there is now support for a query parameter (GET) or body field (POST) <code>_collections</code> that will filter to only those collections, but will not reveal that in link contents. This is useful for the application of permissions to only certain collections.</p>"},{"location":"deployment/#3100","title":"3.10.0","text":""},{"location":"deployment/#node-20-update","title":"Node 20 update","text":"<p>The default Lambda deployment environment is now Node 20. The major difference between the Node 18 and Node 20 Lambda environment is the update of the underlying Linux version from Amazon Linux 2 to Amazon Linux 2023.</p> <p>To update the deployment to use Node 20, modify the serverless config file value <code>provider.runtime</code> to be <code>nodejs20.x</code> and the application re-deployed.</p>"},{"location":"deployment/#310","title":"3.1.0","text":""},{"location":"deployment/#opensearch-version-211","title":"OpenSearch Version 2.11","text":"<ul> <li>Update the <code>EngineVersion</code> setting in the serverless config file to <code>OpenSearch_2.11</code>   and re-deploy</li> </ul>"},{"location":"deployment/#300","title":"3.0.0","text":""},{"location":"deployment/#node-18-update","title":"Node 18 update","text":"<p>The default Lambda deployment environment is now Node 18. The major difference between the Node 16 and Node 18 Lambda environment is that the Node 16 env includes AWS SDK for JS v2, and Node 18 includes v3. This code has been updated to use v3, so the Node 18 environment must be used, or the build must be modified to install the v3 libraries.</p> <p>To update the deployment to use Node 18, modify the serverless config file value <code>provider.runtime</code> to be <code>nodejs18.x</code> and the application re-deployed.</p>"},{"location":"deployment/#240","title":"2.4.0","text":""},{"location":"deployment/#opensearch-version-29","title":"OpenSearch Version 2.9","text":"<ul> <li>Update the <code>EngineVersion</code> setting in the serverless config file to <code>OpenSearch_2.9</code>   and re-deploy</li> </ul>"},{"location":"deployment/#230","title":"2.3.0","text":""},{"location":"deployment/#opensearch-version-27","title":"OpenSearch Version 2.7","text":"<ul> <li>Update the <code>EngineVersion</code> setting in the serverless config file to <code>OpenSearch_2.7</code>   and re-deploy</li> </ul>"},{"location":"deployment/#0x-or-1x-2x","title":"0.x or 1.x -&gt; 2.x","text":""},{"location":"deployment/#fine-grained-access-control","title":"Fine-grained Access Control","text":"<p>As of 2.0.0, only OpenSearch is supported and only using fine-grained access control. It is recommended to follow the migration path to upgrade to fine-grained access control first and then upgrade to stac-server 2.x.</p>"},{"location":"deployment/#enabling-post-ingest-sns-publishing","title":"Enabling Post-ingest SNS publishing","text":"<p>stac-server now has the ability to publish all ingested entities (Items and Collections) to an SNS topic. Follow these steps to add this to an existing deployment. These configurations are also in the serverless.example.yml file, so reference that if it is unclear exactly where to add this in your config.</p> <p>The following changes should be added to the serverless.yml file.</p> <p>Explicitly set the provider/environment setting for STAC_API_URL so the ingested entities published to the topic will have their link hrefs set correctly. If this is not set, the entities will still be published, with with incorrect link hrefs.</p> <pre><code>STAC_API_URL: \"https://some-stac-server.com\"\n</code></pre> <p>Add the SNS topic resource:</p> <pre><code>postIngestTopic:\n  Type: AWS::SNS::Topic\n  Properties:\n    TopicName: ${self:service}-${self:provider.stage}-post-ingest\n</code></pre> <p>For the <code>ingest</code> Lambda resource definition, configure the ARN to publish to by adding:</p> <pre><code>environment:\n  POST_INGEST_TOPIC_ARN: !Ref postIngestTopic\n</code></pre> <p>Add IAM permissions with the statement:</p> <pre><code>- Effect: Allow\n  Action:\n    - sns:Publish\n  Resource:\n    Fn::GetAtt: [postIngestTopic, TopicArn]\n</code></pre>"},{"location":"deployment/#04x-05x","title":"0.4.x -&gt; 0.5.x","text":""},{"location":"deployment/#elasticsearch-to-opensearch-migration","title":"Elasticsearch to OpenSearch Migration","text":"<p>By default, a new deployment of 0.5.x will use OpenSearch instead of Elasticsearch. There are three options if you have an existing deployment that uses Elasticsearch:</p> <ol> <li>Use stac-server in compatibility mode</li> <li>Add to serverless.yml environment variables <code>ES_COMPAT_MODE: \"true\"</code> and retain the       existing Elasticsearch 7.10 resource description.</li> <li>Manage the Elasticsearch/OpenSearch domain outside the stac-server serverless deployment.</li> <li>With the 0.4.x stac-server code, add <code>DeletionPolicy: Retain</code> to the <code>AWS::Elasticsearch::Domain</code> resource</li> <li>Deploy the stack to update this property in the deployed CloudFormation Stack.</li> <li>Remove the <code>AWS::Elasticsearch::Domain</code> resource from serverless.yml, modify all of the variables that were previously dynamically populated by the Elasticsearch resource values to be hard-coded, and re-deploy.</li> <li>The Elasticsearch domain is now independent of the CF Stack.</li> <li>With the 0.5.x stac-server code, update the serverless.yml environment variable <code>ES_COMPAT_MODE: \"true\"</code></li> <li>Deploy the 0.5.x stac-server code with the updated serverless.yml file</li> <li>Through the AWS Console, upgrade the OpenSearch Service domain from Elasticsearch 7.10       to OpenSearch 1.3, retaining the compatibilty mode enabled configuration.</li> <li>Upgrade the OpenSearch 1.3 domain to OpenSearch 2.5.</li> <li>Re-deploy the stack without the ES_COMPAT_MODE environment variable set.</li> <li>(Preferred) Disconnect the Elasticsearch domain from the stac-server CF Stack, deploy a new stac-server CF Stack,    upgrade the Elasticsearch domain to OpenSearch, and connect the domain to the new CF Stack.    This is described below.</li> </ol> <p>Additionally, the <code>ES_HOST</code> variable used in the serverless.yml file has been renamed <code>OPENSEARCH_HOST</code>.</p>"},{"location":"deployment/#preferred-elasticsearch-to-opensearch-migration-process","title":"Preferred Elasticsearch to OpenSearch Migration Process","text":"<p>Note! The migration must be done carefully to avoid losing the database!</p> <p>The major part of this migration is the use of OpenSearch 2.5 instead of Elasticsearch 7.10. Confusingly, both of these are options in the AWS OpenSearch Service, but the Elasticsearch option is no longer being updated by AWS in favor of OpenSearch.</p> <p>The migration generally follows the outline in here. The underlying problem being solved here is that the CloudFormation resource AWS::Elasticsearch::Domain is used for Elasticsearch, but AWS::OpenSearchService::Domain is used for OpenSearch, and a CloudFormation update can't \"migrate\" between these resource types. So, the approach is to upgrade the domain to OpenSearch in compatibility mode, then clone the CloudFormation Stack, and import the OpenSearch domain into it.</p> <ol> <li>With the 0.4.x codebase, change the serverless.yml file to add <code>DeletionPolicy: Retain</code> and <code>UpdateReplacePolicy: Retain</code> to the <code>AWS::Elasticsearch::Domain</code> definition at the same level as the <code>Type</code> and deploy. See instructions for deploying here.</li> </ol> <pre><code>Type: AWS::Elasticsearch::Domain\nDeletionPolicy: Retain\nUpdateReplacePolicy: Retain\nProperties: . . .\n</code></pre> <ol> <li> <p>The existing Elasticsearch domain must be manually migrated to OpenSearch. Prior to    re-deploying the stack, use the AWS Console to manually upgrade the    Elasticsearch domain (<code>Actions-&gt;Upgrade</code>) to OpenSearch 1.3. Select \"Enable    compatibility mode\" to support the existing stac-server 0.4.x code using the Elasticsearch    JavaScript client library (@elastic/elasticsearch version 7.9.0). After this upgrade to    OpenSearch 1.3, then upgrade the domain to OpenSearch 2.5.</p> </li> <li> <p>Create a clone of the stac-server 0.5.x code. Copy and update the serverless.yml file used for the 0.4.0 deployment with these changes:</p> </li> <li> <p><code>ElasticSearchInstance</code> should be renamed to <code>OpenSearchInstance</code></p> </li> <li>The <code>Type</code> of this resource should be changed from <code>AWS::Elasticsearch::Domain</code> to     <code>AWS::OpenSearchService::Domain</code></li> <li><code>ElasticsearchClusterConfig</code> is now <code>ClusterConfig</code></li> <li><code>InstanceType</code> values have changed, e.g., t3.small.elasticsearch is now t3.small.search</li> <li><code>ElasticsearchVersion</code> is replaced with <code>EngineVersion</code> and set to <code>OpenSearch_2.5</code></li> <li><code>EsEndpoint</code> should be renamed to <code>OpenSearchEndpoint</code> and the exported name suffixed   with <code>-os-endpoint</code> instead of <code>-es-endpoint</code></li> <li> <p>Environment variable <code>STAC_API_VERSION</code> should be removed to instead defer to the current default version</p> </li> <li> <p>The <code>DomainName</code> value   must remain the same as it is for the current deployment so   the CloudFormation deployment will import the existing resource. Instead of a parameterized   value of <code>${self:service}-${self:provider.stage}</code> as in the example serverless.yml file,   it would have a hard-coded service name and <code>-es</code> suffix, e.g., <code>my-stac-server-${self:provider.stage}-es</code>.</p> </li> <li> <p>Note: these changes can be checked against the serverless.example.yml file.</p> </li> <li> <p>Run <code>npm run package</code> to generate the CloudFormation templates in the <code>.serverless</code> directory.    Extract from the file <code>.serverless/cloudformation-template-update-stack.json</code> a template    that only has the OpenSearchInstance resource in it. For example:</p> </li> </ol> <pre><code>{\n  \"AWSTemplateFormatVersion\": \"2010-09-09\",\n  \"Description\": \"A STAC API running on stac-server\",\n  \"Resources\": {\n    \"OpenSearchInstance\": {\n      \"Type\": \"AWS::OpenSearchService::Domain\",\n      \"DeletionPolicy\": \"Retain\",\n      \"UpdateReplacePolicy\": \"Retain\",\n      \"UpdatePolicy\": {\n        \"EnableVersionUpgrade\": true\n      },\n      \"Properties\": {\n        \"DomainName\": \"my-stac-server-dev-es\",\n        \"EBSOptions\": {\n          \"EBSEnabled\": true,\n          \"VolumeType\": \"gp2\",\n          \"VolumeSize\": 35\n        },\n        \"ClusterConfig\": {\n          \"InstanceType\": \"t3.small.search\",\n          \"InstanceCount\": 2,\n          \"DedicatedMasterEnabled\": false,\n          \"ZoneAwarenessEnabled\": true\n        },\n        \"EngineVersion\": \"OpenSearch_2.3\",\n        \"DomainEndpointOptions\": {\n          \"EnforceHTTPS\": true\n        }\n      }\n    }\n  }\n}\n</code></pre> <ol> <li> <p>Within CloudFormation, choose <code>Create stack</code> and <code>With existing resources (import resources)</code>.    Upload the template that contains only the OpenSearch resource. Choose a new stack name for this similar to the old one, e.g., <code>my-stac-server-2-{deploy-stage}</code> and update <code>service</code> name in the serverless.yml file with this name without the deploy stage e.g., <code>my-stac-server-2</code>. When prompted for the name of the OpenSearch Domain, put in the name of the existing one, e.g., <code>my-stac-server-dev-es</code>.</p> </li> <li> <p>Deploy the new stack with <code>npm run deploy -- --stage {deploy-stage}</code>. This should appear as an update to the CloudFormation stack that was just created manually, and should use the existing OpenSearch domain.</p> </li> <li> <p>Switch the DNS entry for the domain name to the API Gateway endpoint for the new Stack. See instructions here.</p> </li> <li> <p>Double-check that the <code>DeletionPolicy: Retain</code> is set on the old Stack for the Elasticsearch/OpenSearch resource, and then delete the old Stack.</p> </li> </ol>"},{"location":"deployment/#granting-access-for-thumbnails","title":"Granting Access for Thumbnails","text":"<p>The new experimental endpoint <code>/collections/{c_id}/items/{item_id}/thumbnail</code> will redirect to a URL providing a thumbnail as determined by the assets in an item. This is enabled only if <code>ENABLE_THUMBNAILS</code> is set to <code>true</code>. If the href for this is an AWS S3 ARN, IAM permissions must be granted for the API Lambda to generate a pre-signed HTTP URL instead. For example:</p> <pre><code>- Effect: Allow\n  Action: s3:GetObject\n  Resource: 'arn:aws:s3:::usgs-landsat/*'\n</code></pre>"},{"location":"deployment/#03x-04x","title":"0.3.x -&gt; 0.4.x","text":"<p>Create a new deployment, copy the elasticsearch database, and rename indexes.</p>"},{"location":"deployment/#elasticsearch-upgrade-from-79-to-710","title":"Elasticsearch upgrade from 7.9 to 7.10","text":"<p>The Serverless Framework supports provisioning AWS resources, but it does not support updating existing resources. In 0.4, the default Elasticsearch version has been updated from 7.9 to 7.10. Continuing to use 7.9 should not cause any problems, but it recommended that you manually upgrade to 7.10 by going to AWS Console - Amazon OpenSearch Service, choosing the Elasticsearch domain used by your stac-server deployment (e.g., stac-server-{stage}-es), choose Upgrade from the Actions menu, and then upgrade to Elasticsearch 7.10.</p>"},{"location":"deployment/#disable-automatic-index-creation","title":"Disable automatic index creation","text":"<p>It is now recommended to disable automatic index creation.</p>"},{"location":"deployment/#validate-index-mappings","title":"Validate index mappings","text":"<p>Elasticsearch indices each have a mapping applied that determines how the data is indexed and searched over. These mappings do not change the document data, but can change search behavior. One relevant mapping behavior is that by default, string fields are analyzed for full-text search. In most cases with STAC Items, values such as those in the <code>id</code> and <code>collection</code> fields should not be analyzed and should instead be searchable only by exact matches. In Elasticsearch, this is known as a <code>keyword</code> field type. Importantly, sorting may only be done over <code>keyword</code> typed fields. As of 0.4.0, the default sort is now by <code>properties.datetime</code>, then <code>id</code>, then <code>collection</code>, and results will not be returnd if any indices have the <code>id</code> or <code>collection</code> fields mapped as <code>text</code> instead of <code>keyword</code>.</p> <p>For each index (other than <code>collections</code>), use GET to retrieve the endpoint <code>GET /{collectionId}/_mapping</code>, and validate that <code>properties.datetime</code> type is <code>date</code>, and <code>id</code> and <code>collection</code> mappings are <code>keyword</code> (not <code>text</code> with a <code>keyword</code> subfield). For an AWS Opensearch Service instance, this can be done with a script similar to the one here.</p> <p>The results should look simliar to this:</p> <pre><code>{\n  \"my_collection_name\": {\n    \"mappings\": {\n      \"dynamic_templates\": [\n        ...\n        {\n          \"strings\": {\n            \"match_mapping_type\": \"string\",\n            \"mapping\": {\n              \"type\": \"keyword\"\n            }\n          }\n        },\n        ...\n      ],\n      \"properties\": {\n        ....\n        \"id\": {\n          \"type\": \"keyword\"\n        },\n        \"collection\": {\n          \"type\": \"keyword\"\n        },\n        ....\n        \"properties\": {\n          \"properties\": {\n            ...\n            \"datetime\": {\n              \"type\": \"date\"\n            },\n            ...\n          }\n        },\n        ...\n      }\n    }\n  }\n}\n</code></pre> <p>If this is not the case, the easiest solution to fix it is to:</p> <ol> <li>Deploy a 0.4.0 instance.</li> <li>Backup and restore the 0.3.0 instance's Elasticsearch indices to the 0.4.0 instances's    Elasticsearch database.</li> <li>Create a collection via ingest with a new collection name similar to the existing one (e.g., if index foo exists, create foo_new).</li> <li>Reindex from the the existing index (foo) to the the new one (foo_new).</li> <li>Delete the exiting index and rename the new one to the name of the formerly-existing one (e.g. foo_new -&gt; foo).</li> </ol>"},{"location":"deployment/#next-steps","title":"Next Steps","text":"<ul> <li>Guides &gt; Usage - Learn how to ingest data and use the API</li> <li>Guides &gt; Configuration - Configure collections, extensions, and environment variables</li> <li>Reference &gt; Architecture - Understand the system architecture</li> </ul>"},{"location":"development/contributing/","title":"Contributing to stac-server","text":"<p>Thank you for your interest in contributing to stac-server! This document provides guidelines and instructions for setting up your development environment and contributing to the project.</p>"},{"location":"development/contributing/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Development Environment Setup</li> <li>Contributing to Documentation</li> <li>Running Tests</li> <li>Running Unit Tests</li> <li>Running System and Integration Tests</li> <li>Code Quality</li> <li>Linting</li> <li>Type Checking</li> <li>OpenAPI Validation</li> <li>Updating the OpenAPI Specification</li> <li>Pull Request Process</li> <li>Reporting Issues</li> <li>Code of Conduct</li> </ul>"},{"location":"development/contributing/#development-environment-setup","title":"Development Environment Setup","text":"<p>Install NVM to manage your Node.js environment:</p> <pre><code># uses version in .nvmrc\nnvm install\nnvm use\n</code></pre> <p>The package-lock.json was built with npm 8.5.0, so use at least this version.</p> <p>Install dependencies:</p> <pre><code>npm install\n</code></pre> <p>Useful npm commands:</p> <pre><code># Build the project (runs webpack)\nnpm run build\n\n# Run ESLint\nnpm run lint\n\n# Run both unit and system tests (requires running docker compose containers)\nnpm run test\n\n# Run the API locally\nnpm run serve\n</code></pre> <p>npm-check-updates can be used for updating version dependencies to newer ones:</p> <pre><code>ncu -i\n</code></pre>"},{"location":"development/contributing/#contributing-to-documentation","title":"Contributing to Documentation","text":"<p>The stac-server documentation is built using MkDocs with the Material theme. This section will help you set up the documentation environment and understand our documentation standards.</p>"},{"location":"development/contributing/#setting-up-documentation-environment","title":"Setting Up Documentation Environment","text":"<p>Install the required Python packages:</p> <pre><code>pip install -r requirements-docs.txt\n</code></pre> <p>Virtual Environment</p> <p>Consider using a Python virtual environment to avoid conflicts with system packages: <pre><code>python -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\npip install -r requirements-docs.txt\n</code></pre></p>"},{"location":"development/contributing/#building-documentation-locally","title":"Building Documentation Locally","text":"<p>Serve the documentation locally with live reload:</p> <pre><code>mkdocs serve\n</code></pre> <p>The documentation will be available at <code>http://127.0.0.1:8000/</code>.</p> <p>Build the documentation site:</p> <pre><code>mkdocs build\n</code></pre> <p>The built site will be in the <code>site/</code> directory.</p>"},{"location":"development/contributing/#versioned-documentation","title":"Versioned Documentation","text":"<p>We use mike for versioning documentation. To deploy a new version:</p> <pre><code># Deploy a new version (e.g., v4.5)\nmike deploy v4.5 latest --update-aliases\n\n# Serve all versions locally\nmike serve\n</code></pre>"},{"location":"development/contributing/#documentation-structure","title":"Documentation Structure","text":"<p>The documentation is organized in the <code>docs/</code> directory:</p> <ul> <li>getting-started/: Installation and quick start guides</li> <li>usage/: Basic usage and searching</li> <li>configuration/: Configuration options</li> <li>deployment/: Deployment guides for AWS, Azure, other platforms</li> <li>reference/: Architecture, API reference, STAC compliance</li> <li>development/: Contributing, development workflow</li> <li>about/: Changelog, license, support</li> </ul>"},{"location":"development/contributing/#documentation-standards","title":"Documentation Standards","text":""},{"location":"development/contributing/#markdown-guidelines","title":"Markdown Guidelines","text":"<ul> <li>Use ATX-style headers (<code>##</code> not underlines)</li> <li>Use fenced code blocks with language identifiers</li> <li>Use relative links for internal documentation</li> <li>Include alt text for images</li> </ul>"},{"location":"development/contributing/#mkdocs-material-features","title":"MkDocs Material Features","text":"<p>Admonitions for callouts:</p> <pre><code>!!! note \"Optional Title\"\n    Content here\n\n!!! warning\n    Warning content\n\n!!! tip\n    Helpful tip\n</code></pre> <p>Code blocks with titles:</p> <p><pre><code>```python title=\"example.py\"\ndef hello():\n    print(\"Hello, world!\")\n</code></pre> <pre><code>**Tabs** for alternative content:\n\n```markdown\n=== \"Tab 1\"\n    Content for tab 1\n\n=== \"Tab 2\"\n    Content for tab 2\n</code></pre></p> <p>Navigation cards on the homepage use Material's grid system.</p>"},{"location":"development/contributing/#updating-openapi-documentation","title":"Updating OpenAPI Documentation","text":"<p>The OpenAPI specification is built from JSDoc comments in the source code and deployed to <code>docs/api-spec.html</code>. To update:</p> <ol> <li>Update JSDoc comments in TypeScript source files</li> <li>Run <code>npm run build-api-docs</code> to generate the OpenAPI spec</li> <li>The GitHub Actions workflow automatically builds and deploys it</li> </ol>"},{"location":"development/contributing/#linking-best-practices","title":"Linking Best Practices","text":"<ul> <li>Use relative paths: <code>[Architecture](../reference/architecture.md)</code></li> <li>Link to specific sections: <code>[Search](../usage/search.md#basic-search)</code></li> <li>Verify all links work by building locally</li> </ul>"},{"location":"development/contributing/#diagrams","title":"Diagrams","text":"<p>We use Mermaid for diagrams. Example:</p> <p><pre><code>```mermaid\ngraph LR\n    A[Client] --&gt; B[API Gateway]\n    B --&gt; C[Lambda]\n    C --&gt; D[OpenSearch]\n</code></pre> <pre><code>### Documentation Workflow\n\n1. Make changes to markdown files in `docs/`\n2. Preview changes with `mkdocs serve`\n3. Verify all links and formatting work correctly\n4. Commit changes and open a pull request\n5. The GitHub Actions workflow will automatically deploy approved changes\n\n## Running Locally\n\nBefore the API can be run, OpenSearch and Localstack need to be running. There is a `compose.yml` file to simplify running OpenSearch locally:\n\n```shell\ndocker compose up -d\n</code></pre></p> <p>The API can then be run with:</p> <pre><code>npm run serve\n</code></pre> <p>Connect to the server on http://localhost:3000/</p> <p>Other configurations can be passed as shell environment variables, e.g.,</p> <pre><code>export ENABLE_TRANSACTIONS_EXTENSION=true\nexport OPENSEARCH_HOST='https://search-stac-server-dev-7awl6h344qlpvly.us-west-2.es.amazonaws.com'\nnpm run serve\n</code></pre>"},{"location":"development/contributing/#running-tests","title":"Running Tests","text":"<p>stac-server uses ava as its test runner.</p>"},{"location":"development/contributing/#running-unit-tests","title":"Running Unit Tests","text":"<pre><code># Run all unit tests\nnpm run test:unit\n\n# Run unit tests with coverage\nnpm run test:unit:coverage\n\n# Run tests from a single test file whose titles match 'foobar*'\nnpx ava tests/unit/test-es.js --match='foobar*'\n</code></pre>"},{"location":"development/contributing/#running-system-and-integration-tests","title":"Running System and Integration Tests","text":"<p>The System and Integration tests use an OpenSearch server running in Docker and a local instance of the API.</p> <p>When the system tests run, they:</p> <ol> <li>Wait for OpenSearch to be available</li> <li>Delete all indices from OpenSearch</li> <li>Start an instance of the API at http://localhost:3000/dev/</li> <li>Wait for the API to be available</li> <li>Run the system tests in <code>./tests/system/test-*.js</code></li> <li>Stop the API</li> </ol> <p>Prerequisites:</p> <p>Before running system tests, start OpenSearch:</p> <pre><code>docker compose up -d\n</code></pre> <p>Running these tests requires the <code>timeout</code> utility. On Linux, this is probably already installed. On macOS, install it with:</p> <pre><code>brew install coreutils\n</code></pre> <p>Running system tests:</p> <pre><code># Run all system tests\nnpm run test:system\n\n# Run system tests with coverage\nnpm run test:system:coverage\n\n# Run a subset of system tests matching a glob pattern\nnpm run test:system test-api-item-*\n</code></pre> <p>Running all tests:</p> <pre><code>npm test\n</code></pre>"},{"location":"development/contributing/#code-quality","title":"Code Quality","text":""},{"location":"development/contributing/#linting","title":"Linting","text":"<p>stac-server uses ESLint for code linting:</p> <pre><code># Run linter\nnpm run lint\n\n# Auto-fix linting issues\nnpm run lint-js-fix\n</code></pre> <p>Please ensure your code passes linting before submitting a pull request.</p>"},{"location":"development/contributing/#type-checking","title":"Type Checking","text":"<p>stac-server uses TypeScript for type checking:</p> <pre><code>npm run typecheck\n</code></pre>"},{"location":"development/contributing/#openapi-validation","title":"OpenAPI Validation","text":"<p>Validate the OpenAPI specification:</p> <pre><code>npm run check-openapi\n</code></pre>"},{"location":"development/contributing/#updating-the-openapi-specification","title":"Updating the OpenAPI Specification","text":"<p>The OpenAPI specification is served by the <code>/api</code> endpoint and is located at src/lambdas/api/openapi.yaml.</p> <p>When the API is updated to a new STAC API release, this file must be updated:</p> <ol> <li> <p>Install yq</p> </li> <li> <p>Run the build script:</p> </li> </ol> <pre><code>bin/build-openapi.sh\n</code></pre> <p>This script combines all of the STAC API OpenAPI definitions for each conformance class into one file.</p> <ol> <li>Edit the file to make it specific to this server:</li> <li>Change the title from <code>STAC API - Item Search</code> to <code>STAC API</code></li> <li>Remove all Filter Extension references (if not supported)</li> <li>Fix each endpoint, especially the Landing Page definition (which gets duplicated)</li> <li> <p>Add definitions for each tag</p> </li> <li> <p>Validate the resulting OpenAPI file:</p> </li> </ol> <pre><code>npm run check-openapi\n</code></pre> <p>Fix any errors or warnings reported.</p>"},{"location":"development/contributing/#pull-request-process","title":"Pull Request Process","text":"<ol> <li> <p>Fork the repository and create a new branch from <code>main</code> for your changes.</p> </li> <li> <p>Make your changes following the code style and conventions used in the project.</p> </li> <li> <p>Write or update tests to cover your changes. Ensure all tests pass:    <pre><code>npm test\n</code></pre></p> </li> <li> <p>Run linting and type checking:    <pre><code>npm run lint\nnpm run typecheck\n</code></pre></p> </li> <li> <p>Update documentation if you're adding or changing functionality:</p> </li> <li>Update README.md for user-facing features</li> <li>Update code comments and JSDoc</li> <li> <p>Update OpenAPI specification if API changes are made</p> </li> <li> <p>Commit your changes with clear, descriptive commit messages following conventional commit format when possible.</p> </li> <li> <p>Push to your fork and submit a pull request to the <code>main</code> branch.</p> </li> <li> <p>Respond to feedback from maintainers during the review process.</p> </li> </ol>"},{"location":"development/contributing/#pull-request-guidelines","title":"Pull Request Guidelines","text":"<ul> <li>Keep pull requests focused on a single feature or bug fix</li> <li>Include a clear description of the problem and solution</li> <li>Reference any related issues using GitHub keywords (e.g., \"Fixes #123\")</li> <li>Ensure CI checks pass before requesting review</li> <li>Be responsive to review feedback</li> </ul>"},{"location":"development/contributing/#reporting-issues","title":"Reporting Issues","text":"<p>When reporting issues, please include:</p> <ul> <li>A clear, descriptive title</li> <li>Steps to reproduce the issue</li> <li>Expected behavior vs actual behavior</li> <li>Your environment (Node.js version, OS, etc.)</li> <li>Relevant logs or error messages</li> <li>Screenshots if applicable</li> </ul> <p>Use the GitHub issue tracker to report bugs or request features.</p>"},{"location":"development/contributing/#code-of-conduct","title":"Code of Conduct","text":"<p>This project follows the Contributor Covenant Code of Conduct. By participating, you are expected to uphold this code. Please report unacceptable behavior to the project maintainers.</p>"},{"location":"development/contributing/#getting-help","title":"Getting Help","text":"<ul> <li>Check existing documentation, usage guide, and deployment guide</li> <li>Search existing issues</li> <li>Ask questions in discussions or create a new issue</li> </ul>"},{"location":"development/contributing/#next-steps","title":"Next Steps","text":"<ul> <li>Reference &gt; Architecture - Understand the system architecture</li> <li>Guides &gt; Usage - Learn how to use the API</li> <li>Reference &gt; API Overview - Complete endpoint specifications</li> </ul> <p>Thank you for contributing to stac-server!</p>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>This guide covers installing STAC Server for development and production environments.</p>"},{"location":"getting-started/installation/#development-setup","title":"Development Setup","text":""},{"location":"getting-started/installation/#using-docker-compose-recommended","title":"Using Docker Compose (Recommended)","text":"<p>The fastest way to get started is with Docker Compose:</p> <pre><code># Clone the repository\ngit clone https://github.com/stac-utils/stac-server.git\ncd stac-server\n\n# Start services\ndocker compose up -d\n</code></pre> <p>This starts:</p> <ul> <li>OpenSearch on port 9200</li> <li>STAC API on port 3000</li> <li>Kibana/OpenSearch Dashboards on port 5601</li> </ul> <p>The API will be available at <code>http://localhost:3000</code>.</p>"},{"location":"getting-started/installation/#local-development","title":"Local Development","text":"<p>For active development without Docker:</p> <pre><code># Install dependencies\nnpm install\n\n# Start OpenSearch (required)\ndocker compose up -d opensearch\n\n# Start the API in development mode\nnpm run serve\n</code></pre> <p>The development server includes:</p> <ul> <li>Hot reload on file changes</li> <li>Debug logging</li> <li>Transaction extension enabled</li> <li>No authentication</li> </ul>"},{"location":"getting-started/installation/#production-deployment","title":"Production Deployment","text":"<p>For production deployment to AWS, including infrastructure setup, configuration, and best practices, see the comprehensive Deployment Guide.</p>"},{"location":"getting-started/installation/#docker-production-image","title":"Docker Production Image","text":"<p>Build and run the production Docker image:</p> <pre><code># Build image\ndocker build -t stac-server .\n\n# Run container\ndocker run -p 3000:3000 \\\n  -e STAC_API_URL=https://your-domain.com \\\n  -e ES_HOST=your-opensearch-host \\\n  stac-server\n</code></pre>"},{"location":"getting-started/installation/#environment-variables","title":"Environment Variables","text":"<p>Key environment variables for all deployments:</p> Variable Required Description <code>STAC_API_URL</code> Yes Public URL of the API <code>ES_HOST</code> Yes OpenSearch/Elasticsearch endpoint <code>STAC_ID</code> No Catalog identifier (default: <code>stac-server</code>) <code>STAC_TITLE</code> No Catalog title (default: <code>STAC API</code>) <code>STAC_DESCRIPTION</code> No Catalog description <p>See the Configuration Guide for the complete list.</p>"},{"location":"getting-started/installation/#verification","title":"Verification","text":"<p>After installation, verify the API is running:</p> <pre><code># Check the landing page\ncurl http://localhost:3000\n\n# List collections\ncurl http://localhost:3000/collections\n\n# Check conformance\ncurl http://localhost:3000/conformance\n</code></pre> <p>Expected response from landing page:</p> <pre><code>{\n  \"id\": \"stac-server\",\n  \"type\": \"Catalog\",\n  \"title\": \"STAC API\",\n  \"description\": \"A STAC API\",\n  \"stac_version\": \"1.0.0\",\n  \"conformsTo\": [\n    \"https://api.stacspec.org/v1.0.0/core\",\n    \"https://api.stacspec.org/v1.0.0/item-search\",\n    ...\n  ],\n  \"links\": [...]\n}\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Getting Started &gt; Quick Start - Complete tutorial with sample data</li> <li>Guides &gt; Configuration - Configure collections and extensions</li> <li>Guides &gt; Usage - Learn how to use the API</li> </ul>"},{"location":"getting-started/overview/","title":"Getting Started","text":"<p>Welcome to STAC Server! This guide will help you understand what STAC Server is and how to get started.</p>"},{"location":"getting-started/overview/#what-is-stac","title":"What is STAC?","text":"<p>The SpatioTemporal Asset Catalog (STAC) specification provides a common language to describe geospatial information, making it more easily discoverable and accessible. STAC enables interoperability between systems and allows users to search across multiple catalogs.</p>"},{"location":"getting-started/overview/#what-is-stac-server","title":"What is STAC Server?","text":"<p>STAC Server is a production-ready implementation of the STAC API specification. It provides:</p> <ul> <li>RESTful API: Search and access spatiotemporal data via HTTP</li> <li>OpenSearch Backend: Scalable indexing and search capabilities</li> <li>Serverless Architecture: Runs on AWS Lambda with API Gateway</li> <li>Extensible: Supports multiple STAC extensions out of the box</li> </ul>"},{"location":"getting-started/overview/#key-concepts","title":"Key Concepts","text":""},{"location":"getting-started/overview/#collections","title":"Collections","text":"<p>Collections group related Items together. Each Collection describes:</p> <ul> <li>Spatial and temporal extents</li> <li>Common properties shared by Items</li> <li>Available assets and their formats</li> <li>Licensing and provider information</li> </ul>"},{"location":"getting-started/overview/#items","title":"Items","text":"<p>Items represent individual spatiotemporal assets (e.g., satellite scenes, drone imagery). Each Item contains:</p> <ul> <li>Unique identifier</li> <li>Geometry (footprint)</li> <li>Datetime(s)</li> <li>Properties (metadata)</li> <li>Assets (links to actual data files)</li> </ul>"},{"location":"getting-started/overview/#catalog","title":"Catalog","text":"<p>The root endpoint that provides links to all Collections and search capabilities.</p>"},{"location":"getting-started/overview/#prerequisites","title":"Prerequisites","text":"<p>Before deploying STAC Server, ensure you have:</p> <ul> <li>AWS Account with appropriate permissions</li> <li>Node.js Version defined in .nvmrc or later</li> <li>npm or yarn package manager</li> <li>AWS CLI configured with credentials</li> <li>Serverless Framework (optional, for deployment)</li> </ul> <p>For development:</p> <ul> <li>Docker and Docker Compose</li> <li>OpenSearch</li> </ul>"},{"location":"getting-started/overview/#next-steps","title":"Next Steps","text":"<ul> <li>Getting Started &gt; Installation - Install and configure STAC Server for development or production</li> <li>Getting Started &gt; Quick Start - Get up and running with Docker Compose in 5 minutes</li> <li>Guides &gt; Deployment - Deploy to AWS with production-ready configuration</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get STAC Server running with sample data in 5 minutes.</p>"},{"location":"getting-started/quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker installed</li> <li>Docker Compose installed</li> <li><code>curl</code> or similar HTTP client</li> </ul>"},{"location":"getting-started/quickstart/#step-1-start-the-services","title":"Step 1: Start the Services","text":"<pre><code># Clone the repository\ngit clone https://github.com/stac-utils/stac-server.git\ncd stac-server\n\n# Start services\ndocker compose up -d\n\n# Wait for services to be ready (about 30 seconds)\nsleep 30\n</code></pre> <p>This starts OpenSearch and the STAC API on <code>http://localhost:3000</code>.</p>"},{"location":"getting-started/quickstart/#step-2-verify-the-api","title":"Step 2: Verify the API","text":"<p>Check that the API is running:</p> <pre><code>curl http://localhost:3000\n</code></pre> <p>You should see the catalog landing page with links to <code>/collections</code>, <code>/search</code>, etc.</p>"},{"location":"getting-started/quickstart/#step-3-create-a-collection","title":"Step 3: Create a Collection","text":"<p>Create a sample collection:</p> <pre><code>curl -X POST http://localhost:3000/collections \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"id\": \"sample-collection\",\n  \"type\": \"Collection\",\n  \"stac_version\": \"1.0.0\",\n  \"description\": \"A sample collection\",\n  \"license\": \"proprietary\",\n  \"extent\": {\n    \"spatial\": {\n      \"bbox\": [[-180, -90, 180, 90]]\n    },\n    \"temporal\": {\n      \"interval\": [[\"2020-01-01T00:00:00Z\", null]]\n    }\n  },\n  \"links\": []\n}'\n</code></pre> <p>Verify the collection was created:</p> <pre><code>curl http://localhost:3000/collections/sample-collection\n</code></pre>"},{"location":"getting-started/quickstart/#step-4-ingest-an-item","title":"Step 4: Ingest an Item","text":"<p>Add a sample item to the collection:</p> <pre><code>curl -X POST http://localhost:3000/collections/sample-collection/items \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"type\": \"Feature\",\n  \"stac_version\": \"1.0.0\",\n  \"id\": \"sample-item\",\n  \"collection\": \"sample-collection\",\n  \"geometry\": {\n    \"type\": \"Point\",\n    \"coordinates\": [-122.4, 37.8]\n  },\n  \"bbox\": [-122.4, 37.8, -122.4, 37.8],\n  \"properties\": {\n    \"datetime\": \"2024-01-15T10:30:00Z\",\n    \"title\": \"Sample Item\"\n  },\n  \"assets\": {\n    \"thumbnail\": {\n      \"href\": \"https://example.com/thumbnail.jpg\",\n      \"type\": \"image/jpeg\",\n      \"title\": \"Thumbnail\"\n    }\n  },\n  \"links\": []\n}'\n</code></pre>"},{"location":"getting-started/quickstart/#step-5-search-for-items","title":"Step 5: Search for Items","text":"<p>Now search for items in the collection:</p> <pre><code>curl 'http://localhost:3000/search?collections=sample-collection'\n</code></pre> <p>You should see your sample item in the results.</p>"},{"location":"getting-started/quickstart/#step-6-try-advanced-queries","title":"Step 6: Try Advanced Queries","text":""},{"location":"getting-started/quickstart/#filter-by-bounding-box","title":"Filter by bounding box:","text":"<pre><code>curl 'http://localhost:3000/search?collections=sample-collection&amp;bbox=-123,37,-122,38'\n</code></pre>"},{"location":"getting-started/quickstart/#filter-by-date-range","title":"Filter by date range:","text":"<pre><code>curl 'http://localhost:3000/search?collections=sample-collection&amp;datetime=2024-01-01/2024-12-31'\n</code></pre>"},{"location":"getting-started/quickstart/#use-post-with-json-for-complex-queries","title":"Use POST with JSON for complex queries:","text":"<pre><code>curl -X POST http://localhost:3000/search \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"collections\": [\"sample-collection\"],\n  \"bbox\": [-123, 37, -122, 38],\n  \"datetime\": \"2024-01-01T00:00:00Z/2024-12-31T23:59:59Z\",\n  \"limit\": 10\n}'\n</code></pre>"},{"location":"getting-started/quickstart/#step-7-explore-the-api","title":"Step 7: Explore the API","text":"<p>Visit the interactive API documentation:</p> <pre><code>http://localhost:3000/api\n</code></pre> <p>This provides a complete OpenAPI interface for testing all endpoints.</p>"},{"location":"getting-started/quickstart/#cleanup","title":"Cleanup","text":"<p>When you're done, stop the services:</p> <pre><code>docker compose down\n\n# Remove volumes (deletes all data)\ndocker compose down -v\n</code></pre>"},{"location":"getting-started/quickstart/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/quickstart/#services-not-starting","title":"Services not starting","text":"<p>Check Docker logs:</p> <pre><code>docker compose logs\n</code></pre>"},{"location":"getting-started/quickstart/#connection-refused","title":"Connection refused","text":"<p>Ensure OpenSearch is fully started before the API:</p> <pre><code>docker compose logs opensearch\n</code></pre> <p>Wait for \"Node started\" message.</p>"},{"location":"getting-started/quickstart/#transaction-extension-errors","title":"Transaction extension errors","text":"<p>The Transaction extension is enabled by default in Docker Compose. To disable:</p> <pre><code>ENABLE_TRANSACTIONS_EXTENSION=false docker compose up\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Guides &gt; Usage - Learn about ingesting data, searching, filtering, and aggregations</li> <li>Guides &gt; Configuration - Configure collections, extensions, and environment variables</li> <li>Guides &gt; Deployment - Deploy a production instance to AWS</li> </ul>"},{"location":"reference/api/","title":"API Reference","text":"<p>The STAC Server API implements the STAC API specification version 1.0.0.</p>"},{"location":"reference/api/#openapi-specification","title":"OpenAPI Specification","text":"<p>The complete OpenAPI 3.0 specification is available:</p> <ul> <li>View Raw Spec - Source YAML file</li> <li>Swagger Editor - Interactive viewer with validation</li> <li>Redoc Viewer - Clean documentation view</li> </ul> <p>Local Testing</p> <p>When running a STAC Server instance locally, visit <code>http://localhost:3000/api</code> for an interactive Redoc interface with live API testing.</p>"},{"location":"reference/api/#core-endpoints","title":"Core Endpoints","text":""},{"location":"reference/api/#landing-page","title":"Landing Page","text":"<pre><code>GET /\n</code></pre> <p>Returns catalog links and conformance information.</p>"},{"location":"reference/api/#collections","title":"Collections","text":"<pre><code>GET /collections\nGET /collections/{collectionId}\n</code></pre> <p>List all collections or get a specific collection.</p>"},{"location":"reference/api/#items","title":"Items","text":"<pre><code>GET /collections/{collectionId}/items\nGET /collections/{collectionId}/items/{itemId}\n</code></pre> <p>List items in a collection or get a specific item.</p>"},{"location":"reference/api/#search","title":"Search","text":"<pre><code>GET /search\nPOST /search\n</code></pre> <p>Search for items across collections. POST method supports complex queries with CQL2 filters.</p>"},{"location":"reference/api/#aggregations","title":"Aggregations","text":"<pre><code>GET /aggregate\nGET /collections/{collectionId}/aggregate\nGET /collections/{collectionId}/aggregations\n</code></pre> <p>Generate statistical aggregations and discover available aggregations for collections.</p>"},{"location":"reference/api/#transaction-extension","title":"Transaction Extension","text":"<p>When enabled, supports creating, updating, and deleting resources using the Transaction Extension:</p> <pre><code>POST /collections\nPUT /collections/{collectionId}\nDELETE /collections/{collectionId}\n\nPOST /collections/{collectionId}/items\nPUT /collections/{collectionId}/items/{itemId}\nPATCH /collections/{collectionId}/items/{itemId}\nDELETE /collections/{collectionId}/items/{itemId}\n</code></pre>"},{"location":"reference/api/#extensions-supported","title":"Extensions Supported","text":"<p>STAC Server implements these STAC API extensions:</p> Extension Status Description Core \u2705 Required Basic catalog functionality Item Search \u2705 Required Search endpoint Features \u2705 Required Collection and Item endpoints Transaction \u2699\ufe0f Optional Create/update/delete operations Query \u2705 Included Simple property queries Filter \u2705 Included CQL2 filtering Sort \u2705 Included Sort results by properties Fields \u2705 Included Select specific fields Context \u2705 Included Result count metadata Aggregation \u2705 Included Statistical aggregations"},{"location":"reference/api/#authentication","title":"Authentication","text":"<p>Authentication is deployment-specific. Common patterns:</p> <ul> <li>API Keys: Via <code>X-API-Key</code> header</li> <li>OAuth 2.0: Via <code>Authorization: Bearer</code> header</li> <li>AWS IAM: Via AWS Signature Version 4</li> <li>Public access: No authentication required</li> </ul> <p>Check your deployment documentation for specific requirements.</p>"},{"location":"reference/api/#error-responses","title":"Error Responses","text":"<p>All errors follow RFC 7807 Problem Details format:</p> <pre><code>{\n  \"type\": \"about:blank\",\n  \"title\": \"Bad Request\",\n  \"status\": 400,\n  \"detail\": \"Invalid bbox parameter\"\n}\n</code></pre> <p>Common status codes:</p> <ul> <li><code>200</code> - Success</li> <li><code>201</code> - Resource created</li> <li><code>204</code> - Success (no content)</li> <li><code>400</code> - Bad request (invalid parameters)</li> <li><code>401</code> - Unauthorized</li> <li><code>403</code> - Forbidden</li> <li><code>404</code> - Resource not found</li> <li><code>500</code> - Internal server error</li> <li><code>503</code> - Service unavailable</li> </ul>"},{"location":"reference/api/#next-steps","title":"Next Steps","text":"<ul> <li>Reference &gt; OpenAPI Specification - Interactive API documentation</li> <li>Guides &gt; Usage - Practical examples and tutorials</li> <li>Guides &gt; Configuration - Configure extensions and behavior</li> <li>Reference &gt; Architecture - Understand the system architecture</li> </ul>"},{"location":"reference/architecture/","title":"Architecture","text":"<p>Comprehensive overview of stac-server's architecture, component interactions, and data flows.</p>"},{"location":"reference/architecture/#overview","title":"Overview","text":"<p>Stac-server is a serverless implementation of the STAC API specification built entirely on AWS managed services. The architecture is designed for:</p> <ul> <li>Scalability: Auto-scaling Lambda functions handle any load</li> <li>Cost Efficiency: Pay-per-use pricing with minimal idle infrastructure (OpenSearch cluster runs continuously)</li> <li>Reliability: Managed services with built-in redundancy</li> <li>Event-Driven: Asynchronous ingest pipeline with guaranteed delivery</li> </ul> <p>Core Principle: Separation of read (API) and write (Ingest) paths for optimal performance and reliability.</p>"},{"location":"reference/architecture/#system-components","title":"System Components","text":"<pre><code>graph TB\n    subgraph \"Client Layer\"\n        client[API Clients]\n        publisher[Data Publishers]\n    end\n\n    subgraph \"AWS Edge\"\n        apigw[API Gateway]\n    end\n\n    subgraph \"Compute Layer\"\n        apiLambda[API Lambda]\n        ingestLambda[Ingest Lambda]\n        preHook[Pre-Hook Lambda&lt;br/&gt;optional]\n        postHook[Post-Hook Lambda&lt;br/&gt;optional]\n    end\n\n    subgraph \"Queue Layer\"\n        ingestSNS[Ingest SNS Topic]\n        postIngestSNS[Post-Ingest SNS Topic]\n        ingestSQS[Ingest SQS Queue]\n        dlq[Dead Letter Queue]\n    end\n\n    subgraph \"Data Layer\"\n        opensearch[(OpenSearch)]\n        s3[S3 Buckets&lt;br/&gt;Asset Storage]\n        secrets[Secrets Manager&lt;br/&gt;Credentials]\n    end\n\n    client --&gt;|HTTP/HTTPS| apigw\n    apigw --&gt;|Proxy| apiLambda\n    apiLambda -.-&gt;|Optional| preHook\n    apiLambda -.-&gt;|Optional| postHook\n    apiLambda --&gt;|Query| opensearch\n    apiLambda --&gt;|Generate URLs| s3\n\n    publisher --&gt;|Publish Items| ingestSNS\n    ingestSNS --&gt;|Fan-out| ingestSQS\n    ingestSQS --&gt;|Batch| ingestLambda\n    ingestLambda --&gt;|Write| opensearch\n    ingestLambda --&gt;|Status| postIngestSNS\n    ingestSQS --&gt;|Failed| dlq\n\n    apiLambda -.-&gt;|Credentials| secrets\n    ingestLambda -.-&gt;|Credentials| secrets\n\n    style opensearch fill:#ff9900\n    style apiLambda fill:#ff9900\n    style ingestLambda fill:#ff9900\n    style apigw fill:#ff4f8b</code></pre>"},{"location":"reference/architecture/#component-descriptions","title":"Component Descriptions","text":"Component Type Purpose Scaling API Gateway Managed Service HTTP endpoint, request routing, throttling Auto-scales to millions of requests API Lambda Serverless Function STAC API implementation, query processing Concurrent execution up to account limits Ingest Lambda Serverless Function Process and index Collections/Items Batch processing with SQS triggers Pre-Hook Lambda Optional Function Request authentication/modification Synchronous, adds latency Post-Hook Lambda Optional Function Response transformation/logging Synchronous, adds latency OpenSearch Managed Database Document store and search engine Configurable instance types and counts Ingest SNS Topic Managed Queue Entry point for data ingestion Unlimited throughput Ingest SQS Queue Managed Queue Buffering and batching Unlimited retention Post-Ingest SNS Topic Managed Queue Notification of ingest status Unlimited throughput Dead Letter Queue Managed Queue Failed ingest messages Unlimited retention Secrets Manager Managed Service OpenSearch credentials storage N/A S3 Buckets Object Storage Asset storage (external or managed) Unlimited"},{"location":"reference/architecture/#request-flow","title":"Request Flow","text":""},{"location":"reference/architecture/#standard-api-request","title":"Standard API Request","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API Gateway\n    participant Pre-Hook\n    participant API Lambda\n    participant OpenSearch\n    participant Post-Hook\n\n    Client-&gt;&gt;API Gateway: GET /search?bbox=...\n    API Gateway-&gt;&gt;API Lambda: Lambda Proxy Event\n\n    alt Pre-Hook Enabled\n        API Lambda-&gt;&gt;Pre-Hook: Invoke (async)\n        Pre-Hook--&gt;&gt;API Lambda: Modified Event / Auth Result\n    end\n\n    API Lambda-&gt;&gt;API Lambda: Parse &amp; Validate Request\n    API Lambda-&gt;&gt;OpenSearch: Query with filters\n    OpenSearch--&gt;&gt;API Lambda: Matching documents\n    API Lambda-&gt;&gt;API Lambda: Transform to STAC response\n\n    alt Post-Hook Enabled\n        API Lambda-&gt;&gt;Post-Hook: Invoke (async)\n        Post-Hook--&gt;&gt;API Lambda: Modified Response\n    end\n\n    API Lambda--&gt;&gt;API Gateway: HTTP Response\n    API Gateway--&gt;&gt;Client: STAC FeatureCollection</code></pre> <p>Key Points: - Pre-hook can modify request or reject with 401/403 - OpenSearch queries use JSON DSL for complex filtering - Response includes STAC-compliant links for pagination - Post-hook can add headers, modify body, or log</p>"},{"location":"reference/architecture/#search-query-processing","title":"Search Query Processing","text":"<p>The API Lambda translates STAC API parameters to OpenSearch queries:</p> <ol> <li>Collection Filter: <code>term</code> query on <code>collection</code> field</li> <li>Bbox: <code>geo_bounding_box</code> query on <code>geometry</code> field</li> <li>Datetime: <code>range</code> query on <code>properties.datetime</code></li> <li>CQL2 Filter: Recursive translation to OpenSearch DSL</li> <li>Sort: Maps to OpenSearch <code>sort</code> array</li> <li>Pagination: Uses <code>search_after</code> for efficient deep pagination</li> </ol>"},{"location":"reference/architecture/#ingest-pipeline","title":"Ingest Pipeline","text":""},{"location":"reference/architecture/#message-flow","title":"Message Flow","text":"<pre><code>flowchart TD\n    start[Publisher] --&gt;|Publish JSON| ingestSNS[Ingest SNS Topic]\n    ingestSNS --&gt;|Subscribe| ingestSQS[Ingest SQS Queue]\n    ingestSQS --&gt;|Batch 1-10 msgs| ingestLambda[Ingest Lambda]\n\n    ingestLambda --&gt;|Parse| decision{Message Type?}\n\n    decision --&gt;|href reference| fetch[Fetch from S3/HTTP]\n    decision --&gt;|inline JSON| validate[Validate STAC]\n    fetch --&gt; validate\n\n    validate --&gt;|Valid| type{Type?}\n    validate --&gt;|Invalid| fail[Failed]\n\n    type --&gt;|Collection| collIndex[Write to collections index]\n    type --&gt;|Item| itemIndex[Write to collection-specific index]\n    type --&gt;|Action| action[Execute action truncate]\n\n    collIndex --&gt; transform[Apply Asset Proxy]\n    itemIndex --&gt; transform\n\n    transform --&gt; success[Success]\n\n    success --&gt; notify[Publish to Post-Ingest SNS]\n    fail --&gt; notify\n\n    fail --&gt;|Max retries exceeded| dlq[Dead Letter Queue]\n\n    notify --&gt; subscribers[Subscribed systems]\n\n    style success fill:#90EE90\n    style fail fill:#FFB6C1\n    style dlq fill:#FF6B6B\n    style ingestLambda fill:#ff9900</code></pre>"},{"location":"reference/architecture/#ingest-message-formats","title":"Ingest Message Formats","text":"<p>Inline Item/Collection: <pre><code>{\n  \"type\": \"Feature\",\n  \"stac_version\": \"1.0.0\",\n  \"id\": \"item-id\",\n  \"collection\": \"my-collection\",\n  \"geometry\": {...},\n  \"properties\": {...}\n}\n</code></pre></p> <p>Reference (for large items): <pre><code>{\n  \"href\": \"s3://my-bucket/path/to/item.json\"\n}\n</code></pre></p> <p>Action (delete all items from collection): <pre><code>{\n  \"type\": \"action\",\n  \"command\": \"truncate\",\n  \"collection\": \"my-collection\"\n}\n</code></pre></p> <p>Note: The <code>truncate</code> command deletes all items from the specified collection's index using OpenSearch's <code>deleteByQuery</code> API. This is a destructive operation that requires <code>ENABLE_INGEST_ACTION_TRUNCATE=true</code>. It cannot be used on the collections index or wildcard indices.</p>"},{"location":"reference/architecture/#ingest-processing-steps","title":"Ingest Processing Steps","text":"<ol> <li>Receive: Lambda triggered by SQS with batch of 1-10 messages</li> <li>Parse: Extract STAC document from SNS wrapper and SQS record</li> <li>Fetch: If href reference, retrieve from S3 or HTTP</li> <li>Validate: Check STAC version, required fields, schema</li> <li>Route:</li> <li>Collections \u2192 <code>collections</code> index</li> <li>Items \u2192 <code>&lt;collection-id&gt;</code> index</li> <li>Actions \u2192 Execute command</li> <li>Transform: Apply asset proxy transformations if enabled</li> <li>Index: Write to OpenSearch with upsert semantics</li> <li>Notify: Publish success/failure to Post-Ingest SNS</li> <li>Cleanup: Delete message from SQS or send to DLQ on failure</li> </ol>"},{"location":"reference/architecture/#error-handling","title":"Error Handling","text":"<ul> <li>Transient Errors (network, OpenSearch timeout): Automatic retry via SQS visibility timeout</li> <li>Permanent Errors (invalid JSON, missing collection): Send to Dead Letter Queue after max retries</li> <li>Partial Batch Failures: Successfully processed messages are deleted, failures return to queue</li> </ul>"},{"location":"reference/architecture/#opensearch-index-structure","title":"OpenSearch Index Structure","text":""},{"location":"reference/architecture/#collections-index","title":"Collections Index","text":"<p>Index Name: <code>collections</code> (configurable via <code>COLLECTIONS_INDEX</code>)</p> <p>Mapping Highlights: <pre><code>{\n  \"mappings\": {\n    \"properties\": {\n      \"id\": {\"type\": \"keyword\"},\n      \"type\": {\"type\": \"keyword\"},\n      \"stac_version\": {\"type\": \"keyword\"},\n      \"title\": {\"type\": \"text\"},\n      \"description\": {\"type\": \"text\"},\n      \"license\": {\"type\": \"keyword\"},\n      \"extent\": {\n        \"properties\": {\n          \"spatial\": {\n            \"properties\": {\n              \"bbox\": {\"type\": \"double\"}\n            }\n          },\n          \"temporal\": {\n            \"properties\": {\n              \"interval\": {\"type\": \"date\"}\n            }\n          }\n        }\n      },\n      \"queryables\": {\"enabled\": false},\n      \"aggregations\": {\"enabled\": false}\n    }\n  }\n}\n</code></pre></p> <p>Notes: - <code>queryables</code> and <code>aggregations</code> fields are stored but not indexed (served from API) - One document per collection - Updated via upsert (partial updates not supported)</p>"},{"location":"reference/architecture/#items-indices","title":"Items Indices","text":"<p>Index Name: <code>&lt;collection-id&gt;</code> (one index per collection)</p> <p>Mapping Highlights: <pre><code>{\n  \"mappings\": {\n    \"properties\": {\n      \"id\": {\"type\": \"keyword\"},\n      \"type\": {\"type\": \"keyword\"},\n      \"stac_version\": {\"type\": \"keyword\"},\n      \"collection\": {\"type\": \"keyword\"},\n      \"geometry\": {\"type\": \"geo_shape\"},\n      \"bbox\": {\"type\": \"double\"},\n      \"properties\": {\n        \"properties\": {\n          \"datetime\": {\"type\": \"date\"},\n          \"created\": {\"type\": \"date\"},\n          \"updated\": {\"type\": \"date\"}\n        }\n      },\n      \"links\": {\"enabled\": false},\n      \"assets\": {\"enabled\": false}\n    },\n    \"dynamic_templates\": [\n      {\n        \"strings_as_keywords\": {\n          \"match_mapping_type\": \"string\",\n          \"mapping\": {\"type\": \"keyword\"}\n        }\n      }\n    ]\n  }\n}\n</code></pre></p> <p>Notes: - Dynamic mapping for item properties (strings become keywords by default) - <code>geometry</code> uses <code>geo_shape</code> for complex polygon queries - <code>links</code> and <code>assets</code> stored but not indexed (metadata only) - Index auto-created on first item ingest (can be disabled)</p>"},{"location":"reference/architecture/#index-strategy","title":"Index Strategy","text":"<p>Option 1: Collection Per Index (default) - Pros: Independent scaling, deletion = drop index, custom mappings per collection - Cons: More indices to manage, can't search across collections efficiently</p> <p>Option 2: Shared Index (via <code>COLLECTION_TO_INDEX_MAPPINGS</code>) - Pros: Fewer indices, efficient cross-collection search - Cons: Shared mappings, delete requires query</p>"},{"location":"reference/architecture/#authentication-authorization","title":"Authentication &amp; Authorization","text":""},{"location":"reference/architecture/#opensearch-authentication","title":"OpenSearch Authentication","text":"<pre><code>flowchart LR\n    subgraph \"Fine-Grained Access Control\"\n        lambda1[Lambda] --&gt;|Username/Password| sm1[Secrets Manager]\n        sm1 --&gt; os1[(OpenSearch&lt;br/&gt;Internal User DB)]\n    end\n\n    subgraph \"IAM Authentication\"\n        lambda2[Lambda] --&gt;|IAM Role| sts[STS]\n        sts --&gt;|SigV4| os2[(OpenSearch&lt;br/&gt;IAM Policy)]\n    end\n\n    style lambda1 fill:#ff9900\n    style lambda2 fill:#ff9900</code></pre> <p>Fine-Grained Access Control (Default): - Lambda uses service account (e.g., <code>stac_server</code>) with read/write permissions - Credentials stored in Secrets Manager - Granular role-based permissions within OpenSearch - Admin uses master account for dashboard/CLI access</p> <p>IAM Authentication: - Lambda uses its execution role for OpenSearch access - IAM policies control index-level permissions - No credentials to manage - Requires SigV4 signing for all requests</p>"},{"location":"reference/architecture/#api-authorization-optional","title":"API Authorization (Optional)","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API Gateway\n    participant Authorizer\n    participant Pre-Hook\n    participant API Lambda\n\n    Client-&gt;&gt;API Gateway: Request + Auth Token\n\n    alt API Gateway Authorizer\n        API Gateway-&gt;&gt;Authorizer: Validate Token\n        Authorizer--&gt;&gt;API Gateway: Allow/Deny + Context\n    end\n\n    API Gateway-&gt;&gt;API Lambda: Authorized Request\n\n    alt Pre-Hook Authorization\n        API Lambda-&gt;&gt;Pre-Hook: Request + Headers\n        Pre-Hook-&gt;&gt;Pre-Hook: Check API Key&lt;br/&gt;Build _collections/_filter\n        Pre-Hook--&gt;&gt;API Lambda: Modified Request\n    end\n\n    API Lambda-&gt;&gt;API Lambda: Apply authx filters\n    API Lambda--&gt;&gt;Client: Filtered Results</code></pre> <p>Authorization Layers:</p> <ol> <li>API Gateway Authorizer (external):</li> <li>JWT validation, API key checking</li> <li>Adds context to Lambda event</li> <li> <p>Not included in stac-server</p> </li> <li> <p>Pre-Hook Lambda (included example):</p> </li> <li>Reads API key from header</li> <li>Validates against Secrets Manager</li> <li> <p>Injects <code>_collections</code> or <code>_filter</code> parameters</p> </li> <li> <p>Lambda Authorization Parameters:</p> </li> <li><code>ENABLE_COLLECTIONS_AUTHX</code>: Restrict by collection list</li> <li><code>ENABLE_FILTER_AUTHX</code>: Apply CQL2 filter to all queries</li> </ol>"},{"location":"reference/architecture/#asset-proxy-flow","title":"Asset Proxy Flow","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant API Lambda\n    participant S3\n\n    Note over API Lambda: Asset Proxy Enabled\n\n    Client-&gt;&gt;API Lambda: GET /collections/col/items/item\n    API Lambda-&gt;&gt;API Lambda: Transform asset hrefs\n\n    Note over API Lambda: s3://bucket/path/asset.tif&lt;br/&gt;\u2192&lt;br/&gt;/collections/col/items/item/assets/data\n\n    API Lambda--&gt;&gt;Client: Item with proxy URLs\n\n    Client-&gt;&gt;API Lambda: GET /collections/col/items/item/assets/data\n    API Lambda-&gt;&gt;API Lambda: Check bucket allowlist\n    API Lambda-&gt;&gt;S3: Generate pre-signed URL\n    S3--&gt;&gt;API Lambda: Signed URL (300s expiry)\n    API Lambda--&gt;&gt;Client: 302 Redirect to signed URL\n    Client-&gt;&gt;S3: GET signed URL\n    S3--&gt;&gt;Client: Asset data</code></pre> <p>Asset Transformation:</p> <p>Before (original): <pre><code>{\n  \"assets\": {\n    \"data\": {\n      \"href\": \"s3://my-bucket/path/to/file.tif\",\n      \"type\": \"image/tiff\"\n    }\n  }\n}\n</code></pre></p> <p>After (proxied): <pre><code>{\n  \"assets\": {\n    \"data\": {\n      \"href\": \"https://api.example.com/collections/col/items/item/assets/data\",\n      \"type\": \"image/tiff\",\n      \"alternate\": {\n        \"s3\": {\n          \"href\": \"s3://my-bucket/path/to/file.tif\"\n        }\n      }\n    }\n  },\n  \"stac_extensions\": [\n    \"https://stac-extensions.github.io/alternate-assets/v1.2.0/schema.json\"\n  ]\n}\n</code></pre></p> <p>Proxy Modes (via <code>ASSET_PROXY_BUCKET_OPTION</code>): - <code>NONE</code>: Disabled (default) - <code>LIST</code>: Specific buckets from <code>ASSET_PROXY_BUCKET_LIST</code> - <code>ALL</code>: All S3 assets - <code>ALL_BUCKETS_IN_ACCOUNT</code>: All accessible buckets in AWS account</p>"},{"location":"reference/architecture/#prepost-hook-system","title":"Pre/Post Hook System","text":"<p>The Pre/Post Hook system enables custom logic injection at two key points in the request lifecycle: before request processing (Pre-Hook) and after response generation (Post-Hook). Both hooks are optional Lambda functions invoked synchronously by the API Lambda.</p> <pre><code>sequenceDiagram\n    participant Client\n    participant API Gateway\n    participant API Lambda\n    participant Pre-Hook\n    participant OpenSearch\n    participant Post-Hook\n\n    Client-&gt;&gt;API Gateway: HTTP Request\n    API Gateway-&gt;&gt;API Lambda: Forward Request\n\n    alt Pre-Hook Configured\n        API Lambda-&gt;&gt;Pre-Hook: Invoke with event\n        Pre-Hook-&gt;&gt;Pre-Hook: Validate/Authorize\n        alt Rejected\n            Pre-Hook--&gt;&gt;API Lambda: Return 401/403\n            API Lambda--&gt;&gt;Client: Error Response\n        else Authorized\n            Pre-Hook-&gt;&gt;Pre-Hook: Modify Event\n            Note over Pre-Hook: Add _collections, _filter,&lt;br/&gt;headers, context\n            Pre-Hook--&gt;&gt;API Lambda: Modified Event\n        end\n    end\n\n    API Lambda-&gt;&gt;OpenSearch: Query with filters\n    OpenSearch--&gt;&gt;API Lambda: Results\n    API Lambda-&gt;&gt;API Lambda: Generate Response\n\n    alt Post-Hook Configured\n        API Lambda-&gt;&gt;Post-Hook: Invoke with response\n        Post-Hook-&gt;&gt;Post-Hook: Transform/Log\n        Note over Post-Hook: Modify body, add headers,&lt;br/&gt;send analytics\n        Post-Hook--&gt;&gt;API Lambda: Modified Response\n    end\n\n    API Lambda--&gt;&gt;API Gateway: Final Response\n    API Gateway--&gt;&gt;Client: HTTP Response\n\n    rect rgba(255, 182, 193, 0.3)\n        Note over Pre-Hook: Pre-Hook can reject requests\n    end\n    rect rgba(144, 238, 144, 0.3)\n        Note over Post-Hook: Post-Hook cannot change status\n    end</code></pre>"},{"location":"reference/architecture/#pre-hook","title":"Pre-Hook","text":"<p>The Pre-Hook Lambda is invoked before the API Lambda processes the request, allowing request validation, authorization, and modification.</p> <p>Capabilities: - Read all request headers, query parameters, and body - Reject request (return error response directly with 401/403) - Modify request event (add/change query parameters, modify body) - Add response headers (CORS headers, custom headers) - Inject authorization parameters (<code>_collections</code>, <code>_filter</code> for user-specific filtering)</p> <p>Example Use Cases: - API key validation and quota enforcement - JWT token verification and claims extraction - User-specific collection filtering based on permissions - Request logging and metrics collection - Custom authentication schemes (OAuth, SAML) - Geo-fencing or IP-based access control</p>"},{"location":"reference/architecture/#post-hook","title":"Post-Hook","text":"<p>The Post-Hook Lambda is invoked after the API Lambda generates the response, allowing response transformation and analytics without affecting core logic.</p> <p>Capabilities: - Read full response (status code, headers, body) - Modify response body (transform structure, add computed fields, redact data) - Add or modify response headers (caching, custom headers) - Cannot change HTTP status code - Perform async logging and analytics</p> <p>Example Use Cases: - Response transformation (inject computed fields, normalize structure) - Redaction of sensitive data for specific users - Analytics and metrics collection (usage tracking, performance monitoring) - Custom STAC extension injection - Response caching headers based on content type - A/B testing headers</p>"},{"location":"reference/architecture/#configuration","title":"Configuration","text":"<p>Both hooks are configured via environment variables pointing to Lambda ARNs. The API Lambda's IAM role must have permission to invoke these functions.</p> <pre><code># serverless.yml\nenvironment:\n  PRE_HOOK: arn:aws:lambda:region:account:function:my-pre-hook\n  POST_HOOK: arn:aws:lambda:region:account:function:my-post-hook\n\niam:\n  role:\n    statements:\n      - Effect: Allow\n        Action: lambda:InvokeFunction\n        Resource: \n          - arn:aws:lambda:region:account:function:my-pre-hook\n          - arn:aws:lambda:region:account:function:my-post-hook\n</code></pre> <p>Hook Requirements: - Synchronous invocation (<code>RequestResponse</code> type) - Return proper event/response structure - Handle errors gracefully (timeouts, exceptions) - Pre-Hook: Must return modified event or error response - Post-Hook: Must return modified response object</p>"},{"location":"reference/architecture/#deployment-architecture","title":"Deployment Architecture","text":""},{"location":"reference/architecture/#multi-region-setup","title":"Multi-Region Setup","text":"<pre><code>graph TB\n    subgraph \"Region 1 (us-west-2)\"\n        r53[Route53]\n        cf1[CloudFront Distribution]\n        apigw1[API Gateway]\n        lambda1[Lambda Functions]\n        os1[(OpenSearch)]\n    end\n\n    subgraph \"Region 2 (us-east-1)\"\n        cf2[CloudFront Distribution]\n        apigw2[API Gateway]\n        lambda2[Lambda Functions]\n        os2[(OpenSearch)]\n    end\n\n    subgraph \"Data Replication\"\n        os1 -.-&gt;|Cross-Cluster&lt;br/&gt;Replication| os2\n    end\n\n    r53 --&gt;|Geolocation/Latency| cf1\n    r53 --&gt;|Geolocation/Latency| cf2\n\n    cf1 --&gt; apigw1\n    cf2 --&gt; apigw2\n\n    apigw1 --&gt; lambda1\n    apigw2 --&gt; lambda2\n\n    lambda1 --&gt; os1\n    lambda2 --&gt; os2\n\n    style os1 fill:#ff9900\n    style os2 fill:#ff9900</code></pre> <p>Multi-Region Considerations: - Use OpenSearch Cross-Cluster Replication for data sync - CloudFront for global edge caching - Route53 for geographic routing - Separate ingest per region or centralized</p>"},{"location":"reference/architecture/#high-availability-setup","title":"High Availability Setup","text":"<p>Components: - API Gateway: Multi-AZ by default - Lambda: Multi-AZ by default - OpenSearch: Multi-AZ with dedicated master nodes - SQS: Multi-AZ by default</p> <p>Best Practices: - 3+ OpenSearch nodes across AZs - Enable OpenSearch automatic snapshots - Monitor Lambda concurrent execution limits - Set up CloudWatch alarms for DLQ depth</p>"},{"location":"reference/architecture/#performance-optimization","title":"Performance Optimization","text":"<p>API Response Times: - Cold start: 1-3 seconds (first request) - Warm request: 50-200ms (depends on query complexity) - OpenSearch query: 10-100ms (most queries)</p> <p>Optimization Strategies: 1. Provisioned Concurrency: Keep Lambda warm (costs more) 2. OpenSearch Tuning: Right-size instances, add nodes 3. CloudFront: Cache GET requests for static data 4. Connection Pooling: Reuse OpenSearch connections 5. Pagination: Use <code>search_after</code> instead of <code>from</code>/<code>size</code></p> <p>Ingest Throughput: - SQS: Unlimited buffering - Lambda: Up to 1000 concurrent executions (soft limit) - OpenSearch: Depends on instance size and cluster - Typical: 100-1000 items/second with proper tuning</p>"},{"location":"reference/architecture/#cost-optimization","title":"Cost Optimization","text":"<p>Cost Drivers (typical production deployment): 1. OpenSearch: 70-80% (always running) 2. Lambda Invocations: 10-15% 3. Data Transfer: 5-10% 4. Other Services: 5%</p> <p>Optimization Tips: - Use Reserved Instances for OpenSearch - Right-size OpenSearch cluster (don't over-provision) - Enable response compression - Use S3 for large assets (not OpenSearch) - Monitor and alert on Lambda throttles</p>"},{"location":"reference/architecture/#security-architecture","title":"Security Architecture","text":""},{"location":"reference/architecture/#network-security","title":"Network Security","text":"<pre><code>graph LR\n    subgraph \"Public\"\n        client[Clients]\n        cf[CloudFront]\n    end\n\n    subgraph \"AWS VPC (Optional)\"\n        apigw[API Gateway&lt;br/&gt;Public]\n        lambda[Lambda&lt;br/&gt;VPC or Public]\n        os[(OpenSearch&lt;br/&gt;VPC)]\n    end\n\n    subgraph \"Security Controls\"\n        waf[WAF]\n        sg[Security Groups]\n        nacl[Network ACLs]\n    end\n\n    client --&gt;|HTTPS| cf\n    cf --&gt;|HTTPS| waf\n    waf --&gt; apigw\n    apigw --&gt; lambda\n    lambda --&gt;|VPC Peering&lt;br/&gt;or VPC Lambda| os\n\n    sg -.-&gt;|Control| lambda\n    sg -.-&gt;|Control| os\n    nacl -.-&gt;|Control| os\n\n    style waf fill:#FF6B6B\n    style sg fill:#FFB6C1</code></pre> <p>Security Layers: 1. CloudFront: DDoS protection, SSL termination, WAF 2. WAF: Rate limiting, IP filtering, SQL injection protection 3. API Gateway: Throttling, API keys, resource policies 4. Lambda: Execution role with minimal permissions 5. OpenSearch: VPC isolation, security groups, encryption at rest/in transit 6. Secrets Manager: Encrypted credential storage</p>"},{"location":"reference/architecture/#data-security","title":"Data Security","text":"<p>Encryption: - At Rest: OpenSearch encryption enabled, S3 bucket encryption - In Transit: TLS 1.2+ for all connections - Secrets: AWS Secrets Manager with KMS encryption</p> <p>Access Control: - Least Privilege: Lambda roles with specific permissions - Credential Rotation: Automated via Secrets Manager - Audit Logging: CloudWatch logs for all Lambda invocations - OpenSearch Audit: Fine-grained audit logs (when enabled)</p>"},{"location":"reference/architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Guides &gt; Deployment - Deploy STAC Server to AWS</li> <li>Guides &gt; Configuration - Configure collections and environment variables</li> <li>Reference &gt; API Overview - Complete endpoint specifications</li> <li>About &gt; Contributing - Contribute to the project</li> </ul>"},{"location":"reference/openapi/","title":"OpenAPI Specification","text":"<p>The complete OpenAPI 3.0 specification for STAC Server defines all endpoints, schemas, and extensions.</p>"},{"location":"reference/openapi/#viewing-the-specification","title":"Viewing the Specification","text":"<ul> <li> <p> Source File</p> <p>View or download the raw OpenAPI YAML file.</p> <p> openapi.yaml</p> </li> <li> <p> Swagger Editor</p> <p>Interactive viewer with validation and try-it-out features.</p> <p> Open in Swagger</p> </li> <li> <p> Redoc Viewer</p> <p>Clean, responsive API documentation interface.</p> <p> Open in Redoc</p> </li> <li> <p> Generate Clients</p> <p>Use OpenAPI generators to create client libraries.</p> <p> OpenAPI Generator</p> </li> </ul>"},{"location":"reference/openapi/#specification-highlights","title":"Specification Highlights","text":"<p>The STAC Server OpenAPI specification defines:</p> <ul> <li>40+ endpoints covering all STAC API operations</li> <li>Complete schemas for STAC Collections, Items, and search parameters</li> <li>Extension support for Transaction, Query, Filter, Sort, Fields, and Aggregation</li> <li>Error responses following RFC 7807 Problem Details</li> <li>Examples for all request and response types</li> </ul>"},{"location":"reference/openapi/#using-the-specification","title":"Using the Specification","text":""},{"location":"reference/openapi/#generate-api-clients","title":"Generate API Clients","text":"<p>Use OpenAPI Generator to create client libraries:</p> <pre><code># Install OpenAPI Generator\nnpm install @openapitools/openapi-generator-cli -g\n\n# Generate Python client\nopenapi-generator-cli generate \\\n  -i https://raw.githubusercontent.com/stac-utils/stac-server/main/src/lambdas/api/openapi.yaml \\\n  -g python \\\n  -o ./stac-client-python\n\n# Generate TypeScript client\nopenapi-generator-cli generate \\\n  -i https://raw.githubusercontent.com/stac-utils/stac-server/main/src/lambdas/api/openapi.yaml \\\n  -g typescript-fetch \\\n  -o ./stac-client-ts\n</code></pre>"},{"location":"reference/openapi/#validate-api-responses","title":"Validate API Responses","text":"<p>Use the specification to validate API responses:</p> <pre><code># Install spectral\nnpm install -g @stoplight/spectral-cli\n\n# Validate API responses\nspectral lint openapi.yaml\n</code></pre>"},{"location":"reference/openapi/#api-testing","title":"API Testing","text":"<p>Use the specification with testing tools:</p> <pre><code># Dredd API testing\nnpm install -g dredd\ndredd openapi.yaml http://localhost:3000\n\n# Postman collection generation\nnpx openapi-to-postmanv2 \\\n  -s openapi.yaml \\\n  -o stac-server.postman_collection.json\n</code></pre>"},{"location":"reference/openapi/#local-interactive-documentation","title":"Local Interactive Documentation","text":"<p>When running a STAC Server instance, the <code>/api</code> endpoint provides an interactive Redoc interface:</p> <pre><code># Start server locally\nnpm start\n\n# Visit interactive docs\nopen http://localhost:3000/api\n</code></pre> <p>This interface allows you to:</p> <ul> <li>Browse all endpoints with complete schemas</li> <li>View request/response examples</li> <li>Test API calls directly from the browser</li> <li>Download the OpenAPI specification</li> </ul>"},{"location":"reference/openapi/#specification-conformance","title":"Specification Conformance","text":"<p>The specification implements:</p> <ul> <li>OpenAPI 3.0.3 format</li> <li>STAC API v1.0.0 endpoints</li> <li>OGC API - Features compatibility</li> <li>GeoJSON response formats</li> <li>CQL2 query language (Filter extension)</li> </ul>"},{"location":"reference/openapi/#next-steps","title":"Next Steps","text":"<ul> <li>Reference &gt; API Overview - Human-readable API documentation</li> <li>Guides &gt; Usage - Practical examples and tutorials</li> <li>External &gt; STAC API Spec - Official specification</li> </ul>"},{"location":"usage/","title":"Usage Guide","text":"<p>Comprehensive examples for querying and using the STAC API.</p>"},{"location":"usage/#overview","title":"Overview","text":"<p>This guide provides practical examples and tutorials for working with STAC Server. Whether you're ingesting data, searching for items, or analyzing collections, you'll find step-by-step instructions here.</p> <p>Throughout this guide, <code>${HOST}</code> represents your stac-server base URL.</p>"},{"location":"usage/#getting-started","title":"Getting Started","text":"<p>Stac-server is a web API that returns JSON responses. You can interact with it using:</p> <ul> <li>Command line: <code>curl</code> or <code>wget</code></li> <li>Python: pystac-client - Python library and CLI for STAC APIs</li> <li>Programming languages: Any HTTP client library</li> <li>STAC clients: See STAC Index for specialized tools</li> </ul> <p>Base URL Pattern: Most deployments follow <code>https://{domain}/{version}</code> (e.g., <code>https://earth-search.aws.element84.com/v1</code>)</p> <p>API Documentation: Visit the <code>/api</code> endpoint on any stac-server instance for interactive OpenAPI documentation.</p> <p>Throughout this guide, <code>${HOST}</code> represents your stac-server base URL.</p>"},{"location":"usage/#authentication","title":"Authentication","text":"<p>Most public STAC APIs do not require authentication for read operations. However, production deployments typically require authentication for:</p> <ul> <li>Creating or modifying Collections (Transaction extension)</li> <li>Creating, updating, or deleting Items (Transaction extension)</li> <li>Accessing the aggregations endpoint (if restricted)</li> </ul> <p>Check your deployment's documentation for authentication requirements.</p>"},{"location":"usage/#ingesting-data","title":"Ingesting Data","text":"<p>STAC Collections and Items can be ingested using two methods:</p>"},{"location":"usage/#method-1-sns-topic-recommended-for-aws","title":"Method 1: SNS Topic (Recommended for AWS)","text":"<p>The primary ingestion method is publishing to the SNS Topic <code>stac-server-&lt;stage&gt;-ingest</code>. The ingest Lambda consumes messages from an SQS queue subscribed to this topic.</p> <p>Note: This method requires AWS account access and proper IAM permissions.</p> <p>Important: Collections must be ingested before Items that belong to them.</p>"},{"location":"usage/#publishing-to-sns","title":"Publishing to SNS","text":"<p>Publish a STAC Item or Collection directly:</p> <pre><code>{\n  \"type\": \"Feature\",\n  \"stac_version\": \"1.0.0\",\n  \"id\": \"my-item\",\n  \"collection\": \"my-collection\",\n  ...\n}\n</code></pre>"},{"location":"usage/#large-items","title":"Large Items","text":"<p>For items exceeding the 256 KB SQS message limit, publish a reference:</p> <pre><code>{\n  \"href\": \"s3://source-bucket/path/to/item.json\"\n}\n</code></pre> <p>Supported protocols: <code>s3://</code>, <code>http://</code>, <code>https://</code></p>"},{"location":"usage/#ingest-actions","title":"Ingest Actions","text":"<p>The ingest pipeline supports actions for data management:</p> <p>Truncate collection (removes all items, keeps collection):</p> <pre><code>{\n  \"type\": \"action\",\n  \"command\": \"truncate\",\n  \"collection\": \"my-collection\"\n}\n</code></pre> <p>Note: Requires <code>ENABLE_INGEST_ACTION_TRUNCATE=true</code> in deployment config.</p>"},{"location":"usage/#post-ingest-notifications","title":"Post-Ingest Notifications","text":"<p>After ingest, success/failure events are published to a post-ingest SNS topic with attributes for filtering:</p> <ul> <li><code>recordType</code>: <code>Collection</code> or <code>Item</code></li> <li><code>ingestStatus</code>: <code>successful</code> or <code>failed</code> </li> <li><code>collection</code>: Collection ID</li> </ul> <p>For deployment configuration including SNS subscriptions and error handling, see the Deployment Guide.</p>"},{"location":"usage/#method-2-transaction-extension-direct-api","title":"Method 2: Transaction Extension (Direct API)","text":"<p>If the Transaction Extension is enabled (<code>ENABLE_TRANSACTIONS_EXTENSION=true</code>), you can ingest data directly via the API:</p> <pre><code># Create a collection\ncurl -X POST \"${HOST}/collections\" \\\n  -H \"Content-Type: application/json\" \\\n  -d @collection.json\n\n# Add an item\ncurl -X POST \"${HOST}/collections/{collectionId}/items\" \\\n  -H \"Content-Type: application/json\" \\\n  -d @item.json\n</code></pre> <p>Note: Transaction endpoints typically require authentication in production deployments. This method does not require AWS account access.</p>"},{"location":"usage/#searching-items","title":"Searching Items","text":"<p>The <code>/search</code> endpoint is the primary way to discover STAC Items. It supports both GET and POST methods.</p>"},{"location":"usage/#basic-search-get","title":"Basic Search (GET)","text":"<p>Search using URL query parameters:</p> <pre><code>curl \"${HOST}/search?collections=sentinel-2-l2a&amp;bbox=10,10,15,15&amp;limit=10\"\n</code></pre> <p>Common parameters: - <code>collections</code> - Comma-separated collection IDs - <code>bbox</code> - Bounding box: <code>min_lon,min_lat,max_lon,max_lat</code> - <code>datetime</code> - Temporal filter (ISO 8601): <code>2024-01-01T00:00:00Z/2024-12-31T23:59:59Z</code> - <code>limit</code> - Maximum results to return (default varies by deployment)</p>"},{"location":"usage/#basic-search-post","title":"Basic Search (POST)","text":"<p>POST requests use JSON bodies for more complex queries:</p> <pre><code>curl -X POST \"${HOST}/search\" \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"collections\": [\"sentinel-2-l2a\"],\n  \"bbox\": [10, 10, 15, 15],\n  \"datetime\": \"2024-01-01T00:00:00Z/2024-12-31T23:59:59Z\",\n  \"limit\": 10\n}'\n</code></pre> <p>Advantages of POST: - No URL encoding needed - Supports complex filter expressions - Better for large queries</p>"},{"location":"usage/#understanding-results","title":"Understanding Results","text":"<p>Search responses are GeoJSON FeatureCollections:</p> <pre><code>{\n  \"type\": \"FeatureCollection\",\n  \"features\": [\n    {\n      \"type\": \"Feature\",\n      \"id\": \"item-id\",\n      \"collection\": \"sentinel-2-l2a\",\n      \"geometry\": { ... },\n      \"properties\": { ... },\n      \"assets\": { ... }\n    }\n  ],\n  \"links\": [\n    {\"rel\": \"next\", \"href\": \"...\", \"method\": \"POST\"}\n  ]\n}\n</code></pre> <p>Pagination: Use the <code>next</code> link to retrieve additional results.</p>"},{"location":"usage/#filtering-and-querying","title":"Filtering and Querying","text":"<p>Stac-server supports two filtering extensions for property-based queries.</p>"},{"location":"usage/#query-extension-stacql","title":"Query Extension (STACQL)","text":"<p>Simple comparison operators for basic filtering using the Query Extension. Best for single property constraints.</p> <p>POST example:</p> <pre><code>{\n  \"collections\": [\"sentinel-2-l2a\"],\n  \"query\": {\n    \"eo:cloud_cover\": {\n      \"gte\": 0,\n      \"lte\": 5\n    }\n  }\n}\n</code></pre> <p>Supported operators: - <code>eq</code> - Equal - <code>neq</code> - Not equal - <code>lt</code> - Less than - <code>lte</code> - Less than or equal - <code>gt</code> - Greater than - <code>gte</code> - Greater than or equal</p> <p>GET example (URL-encoded):</p> <pre><code>curl \"${HOST}/search?collections=sentinel-2-l2a&amp;query=%7B%22eo%3Acloud_cover%22%3A%7B%22gte%22%3A0%2C%22lte%22%3A5%7D%7D\"\n</code></pre>"},{"location":"usage/#filter-extension-cql2-recommended","title":"Filter Extension (CQL2) - Recommended","text":"<p>Full CQL2 (Common Query Language) expressions enable complex boolean logic and spatial operations using the Filter Extension.</p> <p>Combining conditions with AND:</p> <pre><code>{\n  \"collections\": [\"sentinel-2-l2a\"],\n  \"filter\": {\n    \"op\": \"and\",\n    \"args\": [\n      {\n        \"op\": \"&lt;=\",\n        \"args\": [{\"property\": \"eo:cloud_cover\"}, 10]\n      },\n      {\n        \"op\": \"&gt;\",\n        \"args\": [{\"property\": \"view:sun_elevation\"}, 30]\n      }\n    ]\n  }\n}\n</code></pre> <p>Combining conditions with OR:</p> <pre><code>{\n  \"filter\": {\n    \"op\": \"or\",\n    \"args\": [\n      {\n        \"op\": \"=\",\n        \"args\": [{\"property\": \"platform\"}, \"sentinel-2a\"]\n      },\n      {\n        \"op\": \"=\",\n        \"args\": [{\"property\": \"platform\"}, \"sentinel-2b\"]\n      }\n    ]\n  }\n}\n</code></pre> <p>Using IN operator:</p> <pre><code>{\n  \"filter\": {\n    \"op\": \"in\",\n    \"args\": [\n      {\"property\": \"platform\"},\n      [\"sentinel-2a\", \"sentinel-2b\", \"landsat-8\"]\n    ]\n  }\n}\n</code></pre> <p>Using BETWEEN operator:</p> <pre><code>{\n  \"filter\": {\n    \"op\": \"between\",\n    \"args\": [\n      {\"property\": \"eo:cloud_cover\"},\n      [0, 20]\n    ]\n  }\n}\n</code></pre>"},{"location":"usage/#important-filtering-rules","title":"Important Filtering Rules","text":"<p>Property naming: - \u2705 Correct: <code>\"eo:cloud_cover\"</code> (no prefix) - \u274c Wrong: <code>\"properties.eo:cloud_cover\"</code></p> <p>Field discovery:</p> <p>Query available searchable properties:</p> <pre><code>curl \"${HOST}/collections/{collectionId}/queryables\"\n</code></pre> <p>Example response:</p> <pre><code>{\n  \"$id\": \"https://example.com/collections/sentinel-2-l2a/queryables\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"eo:cloud_cover\": {\n      \"type\": \"number\",\n      \"minimum\": 0,\n      \"maximum\": 100\n    },\n    \"view:sun_elevation\": {\n      \"type\": \"number\"\n    }\n  }\n}\n</code></pre>"},{"location":"usage/#sorting-results","title":"Sorting Results","text":"<p>Control result ordering using the Sort Extension.</p> <p>Sort by datetime (newest first):</p> <pre><code>{\n  \"collections\": [\"sentinel-2-l2a\"],\n  \"bbox\": [10, 10, 15, 15],\n  \"sortby\": [\n    {\n      \"field\": \"properties.datetime\",\n      \"direction\": \"desc\"\n    }\n  ]\n}\n</code></pre> <p>Multiple sort fields:</p> <pre><code>{\n  \"sortby\": [\n    {\n      \"field\": \"properties.eo:cloud_cover\",\n      \"direction\": \"asc\"\n    },\n    {\n      \"field\": \"properties.datetime\",\n      \"direction\": \"desc\"\n    }\n  ]\n}\n</code></pre> <p>Note: Sort field names use <code>properties.</code> prefix.</p>"},{"location":"usage/#field-selection","title":"Field Selection","text":"<p>Reduce response size by requesting only needed fields using the Fields Extension.</p> <p>Include specific fields:</p> <pre><code>{\n  \"collections\": [\"sentinel-2-l2a\"],\n  \"bbox\": [10, 10, 15, 15],\n  \"fields\": {\n    \"include\": [\"id\", \"geometry\", \"properties.datetime\", \"properties.eo:cloud_cover\"]\n  }\n}\n</code></pre> <p>Exclude fields:</p> <pre><code>{\n  \"fields\": {\n    \"exclude\": [\"links\", \"assets\"]\n  }\n}\n</code></pre> <p>Combine include and exclude:</p> <pre><code>{\n  \"fields\": {\n    \"include\": [\"id\", \"properties\"],\n    \"exclude\": [\"properties.proj:epsg\", \"properties.proj:geometry\"]\n  }\n}\n</code></pre>"},{"location":"usage/#aggregations","title":"Aggregations","text":"<p>The Aggregation Extension provides statistical summaries without returning full items.</p>"},{"location":"usage/#discovering-available-aggregations","title":"Discovering Available Aggregations","text":"<p>Each collection advertises supported aggregations:</p> <pre><code>curl \"${HOST}/collections/{collectionId}/aggregations\"\n</code></pre> <p>Example response:</p> <pre><code>{\n  \"aggregations\": [\n    {\"name\": \"total_count\", \"data_type\": \"integer\"},\n    {\"name\": \"datetime_max\", \"data_type\": \"datetime\"},\n    {\"name\": \"datetime_min\", \"data_type\": \"datetime\"},\n    {\"name\": \"datetime_frequency\", \"data_type\": \"frequency_distribution\"},\n    {\"name\": \"cloud_cover_frequency\", \"data_type\": \"frequency_distribution\"},\n    {\"name\": \"platform_frequency\", \"data_type\": \"frequency_distribution\"},\n    {\"name\": \"grid_code_frequency\", \"data_type\": \"frequency_distribution\"},\n    {\"name\": \"centroid_geohash_grid_frequency\", \"data_type\": \"frequency_distribution\"}\n  ]\n}\n</code></pre>"},{"location":"usage/#requesting-basic-aggregations","title":"Requesting Basic Aggregations","text":"<p>Get summary statistics for matching items:</p> <pre><code>curl \"${HOST}/aggregate?collections=sentinel-2-c1-l2a&amp;bbox=-122.5,37.5,-122.0,38.0&amp;datetime=2024-11-01T00:00:00Z/2024-12-11T23:59:59Z&amp;aggregations=total_count,datetime_min,datetime_max\"\n</code></pre> <p>Response:</p> <pre><code>{\n  \"aggregations\": [\n    {\n      \"name\": \"total_count\",\n      \"data_type\": \"integer\",\n      \"value\": 16\n    },\n    {\n      \"name\": \"datetime_max\",\n      \"data_type\": \"datetime\",\n      \"value\": \"2024-12-09T19:04:10.752Z\"\n    },\n    {\n      \"name\": \"datetime_min\",\n      \"data_type\": \"datetime\",\n      \"value\": \"2024-11-04T19:03:51.120Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"usage/#frequency-distributions","title":"Frequency Distributions","text":"<p>Analyze property distributions across items:</p> <pre><code>curl \"${HOST}/aggregate?collections=sentinel-2-c1-l2a&amp;bbox=-122.5,37.5,-122.0,38.0&amp;datetime=2024-01-01T00:00:00Z/2024-12-11T23:59:59Z&amp;aggregations=datetime_frequency\"\n</code></pre> <p>Response:</p> <pre><code>{\n  \"aggregations\": [\n    {\n      \"name\": \"datetime_frequency\",\n      \"data_type\": \"frequency_distribution\",\n      \"overflow\": 0,\n      \"buckets\": [\n        {\"key\": \"2024-01-01T00:00:00.000Z\", \"data_type\": \"datetime\", \"frequency\": 12},\n        {\"key\": \"2024-02-01T00:00:00.000Z\", \"data_type\": \"datetime\", \"frequency\": 12},\n        {\"key\": \"2024-03-01T00:00:00.000Z\", \"data_type\": \"datetime\", \"frequency\": 12},\n        {\"key\": \"2024-04-01T00:00:00.000Z\", \"data_type\": \"datetime\", \"frequency\": 12},\n        {\"key\": \"2024-05-01T00:00:00.000Z\", \"data_type\": \"datetime\", \"frequency\": 12}\n      ]\n    }\n  ]\n}\n</code></pre> <p>Understanding buckets: - <code>key</code> - Start of time period or property value range - <code>frequency</code> - Number of items in this bucket - <code>overflow</code> - Items that didn't fit in any bucket</p>"},{"location":"usage/#available-aggregation-types","title":"Available Aggregation Types","text":"<p>Basic Statistics: - <code>total_count</code> - Count of matching items - <code>datetime_min</code> - Earliest datetime value - <code>datetime_max</code> - Latest datetime value</p> <p>Frequency Distributions (Property-based): - <code>collection_frequency</code> - Items per collection - <code>platform_frequency</code> - Items per platform (from <code>platform</code> property) - <code>datetime_frequency</code> - Items over time (monthly buckets) - <code>cloud_cover_frequency</code> - Cloud cover ranges (from <code>eo:cloud_cover</code>) - <code>grid_code_frequency</code> - Items per grid cell (from <code>grid:code</code> extension) - <code>sun_elevation_frequency</code> - Sun elevation histogram (from <code>view:sun_elevation</code>) - <code>sun_azimuth_frequency</code> - Sun azimuth histogram (from <code>view:sun_azimuth</code>) - <code>off_nadir_frequency</code> - Off-nadir angle histogram (from <code>view:off_nadir</code>)</p> <p>Frequency Distributions (Spatial): - <code>centroid_geohash_grid_frequency</code> - Items by geohash cell of centroid - <code>centroid_geohex_grid_frequency</code> - Items by geohex cell of centroid - <code>centroid_geotile_grid_frequency</code> - Items by geotile cell of centroid - <code>geometry_geohash_grid_frequency</code> - Items by geohash cell of geometry - <code>geometry_geotile_grid_frequency</code> - Items by geotile cell of geometry</p> <p>Note: Spatial aggregations require setting precision parameters (e.g., <code>centroid-geohash-grid-frequency-precision=4</code>). See the Configuration Guide for details on configuring aggregations.</p>"},{"location":"usage/#spatial-distribution-example","title":"Spatial Distribution Example","text":"<p>Analyze geographic distribution of items:</p> <pre><code>curl \"${HOST}/aggregate?collections=sentinel-2-c1-l2a&amp;bbox=-125,35,-115,42&amp;datetime=2024-01-01/2024-12-31&amp;aggregations=centroid_geohash_grid_frequency&amp;centroid-geohash-grid-frequency-precision=4\"\n</code></pre> <p>Response:</p> <pre><code>{\n  \"aggregations\": [\n    {\n      \"name\": \"centroid_geohash_grid_frequency\",\n      \"data_type\": \"frequency_distribution\",\n      \"buckets\": [\n        {\"key\": \"9q60\", \"frequency\": 145},\n        {\"key\": \"9q8y\", \"frequency\": 132},\n        {\"key\": \"9qh1\", \"frequency\": 98}\n      ]\n    }\n  ]\n}\n</code></pre> <p>Each <code>key</code> is a geohash cell identifier that can be decoded to lat/lon bounds for mapping.</p> <p>Decoding geohashes:</p> <pre><code>import pygeohash as pgh\n\n# Decode geohash to lat/lon and bounding box\nlat, lon = pgh.decode('9q60')  # Returns center point\nbbox = pgh.decode_exactly('9q60')  # Returns (lat, lon, lat_error, lon_error)\n\n# Get bounding box\nfrom geopy import Point\nfrom geopy.distance import distance\n# Calculate bbox from center and errors\n</code></pre> <p>Or use online tools: - geohash.org - Interactive geohash decoder and map - movable-type.co.uk/scripts/geohash.html - Geohash converter</p>"},{"location":"usage/#combining-aggregations-with-filters","title":"Combining Aggregations with Filters","text":"<p>Aggregations respect all search parameters:</p> <pre><code>curl \"${HOST}/aggregate?collections=sentinel-2-c1-l2a&amp;bbox=-122.5,37.5,-122.0,38.0&amp;datetime=2024-06-01/2024-09-01&amp;aggregations=total_count,cloud_cover_frequency\" \\\n  -X POST \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"filter\": {\n      \"op\": \"&lt;=\",\n      \"args\": [{\"property\": \"eo:cloud_cover\"}, 20]\n    }\n  }'\n</code></pre> <p>Configuration: See the Configuration Guide for how to enable and configure aggregations for your collections.</p>"},{"location":"usage/#asset-proxy","title":"Asset Proxy","text":"<p>When asset proxying is enabled, stac-server provides secure access to S3 assets via pre-signed URLs.</p>"},{"location":"usage/#accessing-item-assets","title":"Accessing Item Assets","text":"<p>Get a pre-signed URL for an asset:</p> <pre><code>curl -i \"${HOST}/collections/{collectionId}/items/{itemId}/assets/{assetKey}\"\n</code></pre> <p>Response:</p> <pre><code>HTTP/1.1 302 Found\nLocation: https://s3.amazonaws.com/bucket/path/to/asset.tif?X-Amz-Algorithm=...\n</code></pre> <p>The endpoint returns an HTTP 302 redirect to a temporary pre-signed URL.</p>"},{"location":"usage/#accessing-collection-assets","title":"Accessing Collection Assets","text":"<p>Collections can also have assets (e.g., collection-level thumbnails):</p> <pre><code>curl -i \"${HOST}/collections/{collectionId}/assets/{assetKey}\"\n</code></pre>"},{"location":"usage/#how-proxying-works","title":"How Proxying Works","text":"<p>When asset proxying is enabled:</p> <ol> <li>Original URLs are preserved: S3 URLs stored in <code>alternate.s3.href</code></li> <li>Proxy URLs replace hrefs: Main <code>href</code> points to proxy endpoint</li> <li>Pre-signed on demand: Temporary URLs generated with configured expiration</li> <li>Authentication aware: Can integrate with authorization systems</li> </ol> <p>Example Item asset with proxying:</p> <pre><code>{\n  \"assets\": {\n    \"visual\": {\n      \"href\": \"https://api.example.com/v1/collections/sentinel-2/items/item-1/assets/visual\",\n      \"type\": \"image/tiff\",\n      \"alternate\": {\n        \"s3\": {\n          \"href\": \"s3://bucket/sentinel-2/item-1/visual.tif\"\n        }\n      }\n    }\n  }\n}\n</code></pre> <p>Configuration: See the Configuration Guide for asset proxy settings including: - Bucket access modes (ALL, ALL_BUCKETS_IN_ACCOUNT, LIST, NONE) - URL expiration times - IAM role configuration</p>"},{"location":"usage/#client-libraries","title":"Client Libraries","text":""},{"location":"usage/#python","title":"Python","text":"<p>pystac-client - Official STAC client:</p> <pre><code>from pystac_client import Client\n\n# Connect to stac-server\ncatalog = Client.open(\"https://earth-search.aws.element84.com/v1\")\n\n# Search for items\nsearch = catalog.search(\n    collections=[\"sentinel-2-c1-l2a\"],\n    bbox=[-122.5, 37.5, -122.0, 38.0],\n    datetime=\"2024-01-01/2024-12-31\",\n    query={\"eo:cloud_cover\": {\"lt\": 10}}\n)\n\n# Iterate results\nfor item in search.items():\n    print(f\"{item.id}: {item.properties['datetime']}\")\n</code></pre> <p>Installation: <code>pip install pystac-client</code></p>"},{"location":"usage/#javascripttypescript","title":"JavaScript/TypeScript","text":"<p>stac-js - STAC client for Node.js and browsers:</p> <pre><code>import { STACClient } from '@radiantearth/stac-js';\n\nconst client = new STACClient('https://earth-search.aws.element84.com/v1');\n\nconst results = await client.search({\n  collections: ['sentinel-2-c1-l2a'],\n  bbox: [-122.5, 37.5, -122.0, 38.0],\n  datetime: '2024-01-01/2024-12-31',\n  limit: 10\n});\n</code></pre>"},{"location":"usage/#command-line","title":"Command Line","text":"<p>stac-client - CLI tool:</p> <pre><code># Install\npip install stac-client\n\n# Search\nstac-client search https://earth-search.aws.element84.com/v1 \\\n  --collections sentinel-2-c1-l2a \\\n  --bbox -122.5 37.5 -122.0 38.0 \\\n  --datetime 2024-01-01/2024-12-31\n</code></pre>"},{"location":"usage/#additional-tools","title":"Additional Tools","text":"<p>Browse the STAC Index for more clients including:</p> <ul> <li>QGIS plugins - Desktop GIS integration</li> <li>R packages - Statistical analysis</li> <li>Jupyter notebooks - Interactive exploration</li> <li>Web applications - Browser-based search interfaces</li> </ul>"},{"location":"usage/#next-steps","title":"Next Steps","text":"<ul> <li>Guides &gt; Configuration - Configure queryables, aggregations, and extensions</li> <li>Guides &gt; Deployment - Deploy STAC Server to AWS</li> <li>Reference &gt; Architecture - Understand system components and data flows</li> <li>Reference &gt; API Overview - Complete endpoint specifications</li> </ul>"}]}